\chapter{Model}  \label{chapter-model}
\epigraph{One of the very important components in the urban and agricultural land use model is the so-called \gls{bid-rent curve}. Regional and urban economists, city planners, and economic geographers have used this curve extensively as an analytical device.}{Yeung-Nan Shieh\cite{shiehWilhelmLaunhardtBidRent2004}}


{\color{red}

%We begin in Section~\ref{section-financialize} with a definition of the act of financializing transactions and markets,  and discuss some significant examples. 

%Finally, in  Section~\ref{section-system} we explain how financialization might affect the housing market as a system and some consequences for society in general. 
%At that point we can introduce our specific hypotheses and how we intend to test them.
}
% We  focused on modelling the  effects of financialization on and through the urban housing market to \textbf{WHY?}. 
% This is where the general process of financialization At that point we can introduce our specific hypotheses and how we intend to test them.
% We therefore begin with a narrow and strict definition of the act of finacializing, followed by  an explanation and examples. We then go on to explain how the term is applied at the level of systems and while markets.
% At that point we can introduce our specific hypotheses and how we intend to test them.



% COULD CALL THIS THEORETICAL DEVELOPMENT OF THE MODEL AND MAKE A SEPERATE IMPLEMENTATION CHAPTER

% This chapter describes the specific formulations % (**E USE A MORE SPECIFIC WORD THAN LINKS) % #E BUILD A PCITURE OF HOW THE MODEL DRAWS THESE TOGETHER... LIKE IT TAKES THESE THREAD (LIST THEM) AND COMBINES THEM INTO A MODEL THAT EXPLORE... USE THIS PARRARAPH TO DESCRIBE THE EXACT INTERCONNECTIONS

% the theoretical discussions of the previous chapters with an agent-based simulation model. 

% At the heart of the model is a real estate mark et in which owners, tenants, new entrants to the city and non-resident investors participate. To do that we build up our model in a series of steps beginning with a notion of economic value, adding potential speculative gains, and finally describing a transaction process. %We need to specify the market process in more detail. (???) % i DONT UNDERSTAND IF YOU ARE SAYING YOU NEED THIS? THE MODEL FILLS THIS GAP?? OR THIS IS AFILLER SENTECEN??? 

% This chapter introduce the urban spatial model and labour supply, models the production function with urban scaling of agglomeration effects with density, then introduces a model of financial investment/speculation into a spatially explicit land market model, then calculates profit, considers who gets the profit, and draws conclusions. 

% \section{The general structure of the model}
The main goal of this research is to add a financial system to a spatial urban model %to the simple Alonzo model 
in order to examine the impact of financialization of the housing market on urban productivity and distribution. To do this we develop an \gls{agent-based model} with three major components: 

{\newpage\thispagestyle{empty}
\vspace{-1.5cm}
\begin{figure}
\vspace{-1cm}
\caption{Model logic }\label{figure-logic}
\begin{adjustwidth}{-0.24\textwidth}{-0.24\textwidth}
    \centering
    \includegraphics[scale=.75]{fig/flow_full_model.png}
    \label{Stylized model flow.}
%\pagestyle{headings}
% \usetikzlibrary{positioning}
%\begin{tikzpicture}[remember picture,overlay,shift={(current page.north east)}] \node[anchor=north east,xshift=-1cm,yshift=-1cm]{\includegraphics[width=1cm]{example-image-a}};\end{tikzpicture}
\end{adjustwidth}
\end{figure}
}

\begin{enumerate}
\item We incorporate the spatial structure of the city and its transportation system using a version of the \gls{bid-rent function} that drives all Alonzo-style models. This equation is embedded in the decision of every agent because it determines the economic rent  for each piece of property..

\item We incorporate the fundamental wealth production process of the city by using an \gls{urban scaling} law that captures Jacobs-style agglomeration effects. This allows us to bypass the complexities of labour and goods market adjustments and and instead to deal with the underlying long-term relationship between city  population and production. We have called the combination of this Jacob agglomeration effect with the Alonzo model an \gls{Alonzo-Jacobs model}.  Two difference equations operating on two aggregate variables incorporate the major insight of a half-century of \gls{neoclassical growth theory}.

\item To link the Alonzo-Jacobs model to the financial system, we develop an \gls{overlapping generations} model of the housing market with borrowers and lenders that tracks ownership and wealth. This turns out to be the most detailed and computationally-intensive part of the model. To model the effects financializing housing an \gls{agent-based model} we are forced to carefully specify the microeconomics of  individual decisions. In Section~\ref{section-micro}, therefore, we describe the microeconomic objective function that individuals and our bank agent employ in deciding to purchase a property. 
\end{enumerate}

To recapitulate, we have a spatial model of an urban housing market, a production function modelling how urban regions generate wealth, and an analysis of distribution within that model that incorporates the financial system.

Figure~\ref{figure-logic} shows the model flow/logic. 
The following three sections with discuss each of the three primary components, the spatial structure, the productivity mechanism, and the housing market in order. (CHECK ORDER IN INTRO), Finally, in  Section~\ref{section-system} we explain how financialization might affect the housing market as a system and some consequences for society in general. %At that point we can introduce our specific hypotheses and how we intend to test them.

\section{Spatial structure}

% In this section, we introduce the basic structure of the model, drawing on the circular city model.  
%  we introduce the production function, introduce the labour supply and the urban model, the source of the surplus,  then we calculate profit, consider who gets the profit, and from there we draw our conclusions.. then we calculate the urban surplus, and consider who gets it. 
% % In subsequent sections  .. (Derivation details in section \ref{Sec:Derivations})
% We build a spatially explicit agent model where agents work in one location and incur costs travelling to work. This work integrates a model of production and labour into a standard spatial model of the city. In this section, we introduce an analytic model of production and a labour market in a stylized circular city. 

% \subsection{Labour supply for production}
We begin with a model of a circular city %- INTRO CITY/APPROACH?
Following the \gls{Alonzo model} \cite{alonzoTheoryUrbanLand1960}, (\cite{alonsoLocationLandUse1964}, firms are located at the centre of a circular city, the central business district. Residents are distributed across space, can take jobs, and commute to work at the center. 
% In the simplest version, firms concentrate at the city centre. Workers are spread over space and pay transportation costs to commute.

Firms produce perfectly \gls{substitutable} goods to sell% For simplicity, firms produce a variety of  goods, 
which they sell into a commodity market. Demand for the \gls{product} is \gls{perfectly elastic}, so the price remains constant. Firms purchase the time of workers %to capture the product of their effective labour
%and enjoy the product of \gls{effective labour} . They can produce more goods by hiring additional workers. 
There is an agglomeration effect that augments the productivity of workers: firms can produce more goods with a given stock of labour if the city is larger (the Jacobs effect). Firms can therefore pay a premium because urban workers are more productive than rural workers due to the positive agglomeration externalities. We assume that the neoclassical model of distribution holds in the long run and workers receive their full value marginal product.
%in a city with more people, as introduced in Chapter \ref{chapter-growth} on growth.(**E SEE NOTE HERE) % #E i THINK YOU NEED TO FLESH THIS OUT, i'M NOT SURE EXACTLY WHAT YOU ARE SAYING. JUST BE A BIT MORE SPECIFIC AND FLESH OUT. 
% \subsection{Labour force}
%There are also firms that produce goods to sell. (???) % #E HOW IS THIS DIFFERENT THAN THE FIRMS PRODUCING GOODS IN THE PREVIOUS PARAGRAPH???

% Firms sell the goods they produce into a commodity market. 
 %, which are both exported and locally consumed 
% to sell into a large market, at a fixed price. 

 We assume workers receive a \gls{subsistence wage}, $\psi$, in the countryside, which could come from work in the local community, living off the land, family support, social support, or something else.
To attract workers to live in the city and commute to the central business district, firms pay an  \gls{urban wage premium}, $\omega$, in addition to  the subsistence wage $\psi$. 
%\footnote{See parameter Appendix section \ref{section-wage-premium} for a discussion of the empirical literature on the \gls{urban wage premium}.}. 
% When workers take a job, they give up the subsistence income and, % instead receive a wage from their employer. % When workers take a job, they  receive, in addition to the subsistence wage,  the wage premium  from their employer. 
Urban workers give up the subsistence income, and receive the \gls{urban wage}, which is the subsistence wage plus the urban wage premium $\psi +  \omega$. 


% TODO this shows the dynamics of a local economy, trade dynamics dominate local dynamics in many cases, that is explored with the addition of more cities and centres. 
 
%NEED TO INTRODUCE SUBSISTENCE WAGE BEFORE MENTIONING IT ABOVE %[MAYBE This follows xyz's approach, and makes it possible to explore resident's choice to work]. 


% {\newpage\thispagestyle{empty}
% \vspace{-1.5cm}
% \begin{figure}
% \vspace{-1cm}
% \begin{adjustwidth}{-0.24\textwidth}{-0.24\textwidth}
%     \centering
%     \includegraphics[scale=.75]{fig/flow_full_model.png}
%     \label{Stylized model flow.}
% \caption{Model logic TODO: CAN WE SUPPRESS THE CHAPTER TITLE/PAGE NUMBER, AT TOP OF PAGE, SO THERE IS NOT A LINE ABOVE? add }%\pagestyle{headings}
% % \usetikzlibrary{positioning}
% %\begin{tikzpicture}[remember picture,overlay,shift={(current page.north east)}] \node[anchor=north east,xshift=-1cm,yshift=-1cm]{\includegraphics[width=1cm]{example-image-a}};\end{tikzpicture}
% \end{adjustwidth}
% \end{figure}
% }


The {urban wage premium} and transportation cost together determine both the radius of the circular city and the size of the labour force, %?There is no fixed boundary and the size of the city is determined by the utility that can be achieved in competing regions of competing for labour.
% and as in the standard circular city model the constraint on growth is provided by transportation costs, which limit the size of the commuter-shed and therefore the labour force at any wage. 
 %The raidus of the commuter shed is thus,  %The farthest workers will travel to work is thus 
% The  productivity of the city attracts people. 
since agents will only work if the wage premium is greater than the cost of travel. % Living close to work has value to workers because it saves the cost of transportation. 
The higher the wage, the  farther workers will commute. This is the core of the Alozo circular city model. The farthest workers will travel  is $\frac{w}{{c}}$, where ${c}$ is the cost of transportation per unit distance. This defines the radius of the circular city and the commuter shed.

We assume a uniform lot size, $s$, with one worker per unit land, so the labour available in the \gls{circular city} is simply the area of the circle divided by lot size: 
\begin{equation}
%=  \frac{\pi}{s}(c^{max})^2	
 L = \frac{\pi}{s} \left(\frac{w}{{c}}\right)^2
   =\frac{\pi}{{c}^2 s} w^2,
\label{eqn-labour-supply1}
\end{equation}
This is the equilibrium \gls{urban labour supply} curve. It is our version of the standard urban \gls{population equilibrium} condition for models of this class, which is a \gls{migration equilibrium} \cite{GET_migration_equilibOR_pop_equilib_condition}. %It defines the quantity of labour available.

In the agent model, the \gls{urban labour supply} is an \gls{aggregate} measure that emerges from individual agents' choice to commute % model rules, and individual 
and firm hiring behaviour. %and the job search process. 
In practice, many other factors impinge on these choices. %additional decision factors, agents, driving variable, and \gls{stochastic} elements enter the model. %\footnote{See the discussion of model extensions in Appendix \ref{appendix-future-work}.}.
% To get the \gls{urban wage premium}, we can write the inverse of the labour supply function:
% \begin{equation}
% w= (\frac{ {c}^2s}{\pi})^{0.5} L^{0.5}.
% \label{eqn-inverse-labour-supply}
% \end{equation}

\section{Agglomeration}
% *** ADD BACK? To study the productivity of cities, we incorporate Jacobs-style agglomeration economies (\cite{beaudryWhoRightMarshall2009, vanderpanneAgglomerationExternalitiesMarshall2004, jacobsEconomyCities1969}), using an approach similar to the way the \gls{Solow-Swan model} incorporates labour-augmenting technical change with a \gls{Cobb-Douglas} production function, and building the production function into a standard Alonso-style model of an urban economy.
%, using a simple Cobb-Douglas production function. 
% We incorporate the estimated scaling relationship in 
%The scaling result at the level of the city allows us to incorporate the agglomeration effect in a \gls{circular city} model, 

 \Glspl{agglomeration effect} ensure urban \gls{output} is more than proportional to urban population: 
 \begin{equation}
 Y\propto N^{\beta},
 \label{eqn-production-population}
 \end{equation}
where $\beta$ is the elasticity of output with respect to capital,  $\beta >1$.   

According to \gls{neoclassical distribution theory}, the firm maximizes profit by setting the marginal value of the product of each \gls{factor of production} equal to the unit cost per factor. This means the wage premium increases in the same relation to population as \gls{productivity} does:
\begin{equation}
\omega\propto N^{\beta-1}.
\label{eqn-wage-population}
\end{equation}


% The city has single firm facing a fixed price for output. 

% IS THIS DUPLICATION? I THINK THE Solow-Swan model IS INTRODUCED IN SPACE CHAPTER. MOVE THIS TO SPACE CHAPTER IF NEEDED?
% In the \gls{Solow-Swan model}:
% \begin{equation} 
% Y(t) = K(t)^{\alpha}(A(t)L(t))^{\beta}
% \label{Eqn:Solow-Swann}
% \end{equation}
% where $Y$, $K$ and $L$ are aggregate output, capital, and labour, respectively,  $A$ is the term the Solow-Swan model introduced for technology. The technology term capture the growth of labour productivity over time, $\alpha$ is the \gls{elasticity} of output with respect to capital, $\beta$ the elasticity of \gls{output} with respect to \gls{effective labour}, and $t$ time. If $\beta=1-\alpha$, this is a constant returns to scale \gls{CRS} production function at the firm level.
% In the Solow-Swan model all factors of production are fully employed, and initial values $A(0)$, $K(0)$, and $n( 0 )$ are given. The number of workers, i.e. labour, as well as the level of technology grows exogenously at rate %s are $n$ and it   $g$,% respectively:  $L(t)=L(0)e^{nt}$     $A(t)=A(0)e^{gn}$ 
% This model uses a similar functional form to look at the effect of population density increasing % productivity. %how density increases in in  % It models how population increases productivity. 
 
 We are implicitly using a three-factor model of \gls{production}, where production, is a function of capital and labour as well as a third factor, a Solow-Swan style term for labour augmenting technical change, with an \gls{agglomeration} effect, $A(N)$, in place of technology, $A(t)$. Output is:

\begin{equation}
Y=A(N)K^{\alpha }(A(N)N)^\beta.
\label{Eqn:Prod1}
\end{equation}
where $K$ is capital, $\alpha$ is the elasticity of output with respect to capital, $\alpha = \beta - 1$, and  $n$ is the \gls{urban labour supply}. $A(N)$ incorporates Jacob-style agglomeration externalities. $A(N)N$ is \gls{effective labour}. 
\footnote{The function  was discussed in Chapter~\ref{chapter-growth}}. 

% \section{Agglomeration Appendix: Production Function}
% SORT APPENDIX/OTHER STUFF

% WHAT DO WE WANT TO ADD BACK IN/CLARIFY FROM WHAT'S BELLOW? 
% WHAT DO WE WANT TO MOVE TO THE GROWTH CHAPTER OR AN APPENDIX?

% The agglomeration factor increases with population. It multiplies labour because agglomeration scales the productivity of workers.  
% It is a model of a productive urban economy since the centre is productive and demands labour.
% The growth of population feeds back into productivity. % We allow rising population to directly increase the wage.  
% We supplement the spatial model with agglomeration effects consistent with the literature. % in the base model. 
% There is an agglomeration effect, which
% The agglomeration effect means firms can also produce more goods by operating in a city with more people, because of the connections and interactions between people (CITE). 
 
 %, we assume the presence of scaling, consistent with neoclassical growth models as discussed in Chapter \ref{chapter-growth}. 
%In this section, we introduce the basic structure of the production side and connect it to the literature on urban scaling. 
% We bypass the complexity of modelling firms, allowing population increases to directly increase urban wage premium.
%, It is straightforward to compute the rate of excess return for  this model. 

% We assume that the firm behaves as a price taker in the labour market as well, despite the fact that we model it as a \gls{monopsonist}\footnote{}. JUSTIFY/REPHRASE/EXPLAIN monopsonist. %ALSO DOES THIS GO HERE OR BELONG WITH PRIOR SECTION?

% Labour demand is thus a derived demand based on standard neoclassical theory with an equilibrium wage offer that is the marginal (value) product of labour for the firm. Specifically, hiring proceeds until the marginal product of labour is equal to the wage.

% The firm adjusts its labour force upward when the \gls{marginal product of labour} is greater than the wage by selecting from its list of job applicants.
% The firm adjusts its wage offer upward when the marginal product of labour is greater than the wage and it faces a labour shortage.  Labour shortage is a situation where the firm wants to hire but its list of job applicants is empty.

% The marginal product of labour is monotonically declining, ensuring a labour market equilibrium, to connect with the analytic tradition of economic modelling by ensuring there is an equilibrium level of production.  While adding more labour may always adds some value, the rate at which it adds value drops off. 
% If the marginal product increased, then a firm that got large enough would out compete smaller firms, hire all labour, always be able to produce more wealth by hiring more people, and would always produce more wealth by hiring people than by firing people. This doesn't happen. 
% Perhaps, the firm hires employees who best fit its needs first, but to grow, eventually it must hire less selectively. Finding markets may get harder with growth. Perhaps expansion adds additional costs, building a parking lot, administration, acquiring a larger building. Whatever the explanation, the marginal product of labour declines. 

% Frictional unemployment usually just refers to people moving between jobs. When people look for jobs, it may take time to get them. The analytic model offers an equilibrium solution with full employment. In the agent-based model this assumption does not hold, workers are laid off, and take time to find new employment.
% labour adjustment costs include moving costs for the employee or hiring, firing, or training cost for the firm. (there might be a hiring, firing, or training cost on the firm side, or on the employee side: expected time to employment costs, moving costs, etc.)
% The assumption of monotonically embedded marginal product of labour is embedded in the production function, so it applies in the analytic and agent models. This appears in the requirement that the sum of the exponents in the \gls{Cobb-Douglas} are less than one without agglomeration effects. Agglomeration effects can push the sum above one. When the exponents add up to less than one, there are diminishing returns to scale.  Exploring alternatives would involved exploring other formulations of the production function.

% $mvp(x) = p(x)$ where x can be labour, capital or any other factor, falls out of the function when you introduce profit maximization. Continuity and differentiability assumed but it is a convenient approximation-- take away assumptions you typically get a close approximation.

% We have a two factor model of production with labour and capital.  

\section{Financialization}
%Our goal is to look at the relationship between urban production/labour markets, agglomeration, and land/housing markets. To explore this relationship we build a simplified model of a \gls{housing market}.% CALL IT LAND, PROPERTY, OR HOUSING MARKET? % - it is the housing use, combined with location we're interested in. % we introduce a \gls{land market}.% Agents purchase homes though a housing market. 

In practice, housing is exchanged on a market. The product is properties, at a particular location, which include land and buildings, or units in larger developments. Properties have individual features including building size, style, quality, and even neighbourhood features that affect their desirability. %the buildings have a particular size and characteristics. %with various buildings and features. %properties on them. 
%Location also matters, %Land value  is affected by various elements
%including proximity to natural features like lakes and mountains, and human-built features like communities, and businesses, as well a developments and additions on the property itself. 
%Thereal market invovles  a set of agents who engage directly like buyers, sellers, renters, investors, and developers; as well as others who shape the market indirectly, including policymakers, activists, and neighbourhood and industry groups.
%The actors work within the context of a layer of policy, institutions, and rules. For example financial institutions offer debt, zoning allows certain uses and disallows others, and tax rules shape financial returns.

% and charges taxes and fees which are factored into the cost structure.
% shapes the land value.
% Our simulation model extracts % #E IS THIS A TECHNICAL TERM? i DON'T KNOW WHAT IT MEANS? yOU USE THESE TOGETHER. IF ITS STANDARD USAGE IGNORE THIS COMMENT
% these features to explore a core set of questions about financialization in land markets, in a way that's extensible to study a broad range of questions about real/particular markets in particular places.
% We study \gls{financialization} in a simplified market model, integrating
% In the simplified market model, %  owners sell when the retire.
% we integrate the % spatially explicit property market
% our urban production model  into a spatially explicit {housing market} with financial investment. %\gls{financialized} investment.

%Urban productivity drives land values through the housing market. Where there is a strong labour market, residents have a greater willingness to pay for housing \cite{GET_productivity_price_link} %ELABORATE. 
% Other factors also shape prices, including \gls{amenity}.

% *** In the model, rising \gls{population} and \gls{productivity} generate an economic value for land, that's derived from its proximity to the \gls{urban center}. 

% Use of a unit of land in each cycle is valued at the wage premium net of transportation costs. 
 % A worker, located at a distance $d$ from work, paying as much as $w- {dc}$ in rent, would still choose to work.

%\subsection{The microeconomics of  financialization}\label{section-micro}

Financialization happens at this microeconomic level, where individual decisions are made and  real assets are bought by individuals and institutions. Individual home-buyers are buying a stream of housing services and possible capital gains. Institutional buyers are buying a stream of net rents plus speculative gains. Each agent has their own interest rates, discount rates, mortgage share, information, and expectations, so individual bids can differ.

%In the process, the real asset takes on an additional and separate aspect as financial object that can be bought and sold. 

The feature that matters most to investors is the  \gls{rate of return} that  an asset offers. For any level of risk and liquidity, an investor will choose to purchase the asset with the highest rate of return. When a home is bought to live in, the potential buyer makes a similar calculation, perhaps with a greater emphasis on the value of the stream of housing services. When home prices are rising rapidly speculative gains may become the dominant concern of home buyers. 

To model the investment decision  we therefore need to calculate the \gls{rate of return} on each property taking into account the rental revenue, the potential capital gain, the investors' costs of capital, incomes, and assets. The analysis will show the incentive structure driving the  financialization of the housing market. We do this in detail in Appendix~\ref{appendix-bid-price} 
The model must  allow for bidding and speculative investment but also must reflect the underlying economic value driven by urban productivity. To calculate the \gls{rate of return} we, therefore, need to define  the relevant variables, and make some distinctions among different notions  of rent and price %, including a variety of prices perceived prices  bid price3s
\subsection {Variables}

\subsubsection{Rent} \label{sec-Rent}
The explicit treatment of rents and the relationship between the productivity \gls{premium} and the \gls{subsistence wage}
is also what makes this a ``\gls{classical}'' model. 


% *** TABLE ALSO NEEDS NET RENT $\mathcal{R}_N$ - WE SHOULD THINK ABOUT BEST WAY TO COMMUNICATE RELATIONSHIPS BETWEEN RENT TERMS.
\begin{table}[!ht]
\centering
{\renewcommand{\arraystretch}{1.6}
\begin{tabular}{r|c|c|c|c|c|c|c|}\cline{2-8}
       & Warranted  & Market & Expected & $i$'s Expected & Reservation & Asking & Bid     \\ \cline{2-8}
Price  & $P_{W_j}$      & $P_{M_j}$  & $P_{M_j}^\epsilon$ & $P_{M_{ij}}^{\epsilon}$     & $P_{R_{ij}}$       & $P_{A{ij}}$  & $P_{B{ij}}$   \\ \cline{2-8}
Rent  & $\mathcal{R}_{W_j}$      & $\mathcal{R}_{M_j}$  & $\mathcal{R}_{M_j}^\epsilon$ & $\mathcal{R}_{M_{ij}}^{\epsilon}$     &       &   &   \\ \cline{2-8}
% Rent $\mathcal{R}_W$ & $\mathcal{R}_W$ &        &       &             & $\mathcal{R}_M$ &          &               \\ \cline{2-8}
\end{tabular}
 }   
\caption{Price and rent notation}
% \caption[In introducing the quantities here, we include indices for the agent, $i$, and the property $j$, for clarity. In the following development we'll only use the subscripts where needed to distinguish between agents and properties]{Price and rent notation\protect\footnotemark} % https://tex.stackexchange.com/questions/10181/using-footnote-in-a-figures-caption
\label{table-price-notation}
\end{table}
% There are three pieces to this analysis - there's the warranted price based on the underlying economic value of living in a property, the link here with urban productivity, there's the biding and negotiation process, and then there's the realized market price. 


To develop the analysis, we have to keep track of a number of different quantities, outlined in Table \ref{table-price-notation}\footnote{In the table, we include indices for agent $i$ and property $j$, for clarity. In the following development we'll only use the subscripts where needed to distinguish between agents and properties.}. 

In the model, agents set these values with the support of a real estate agent, and based on information provided by their bank about lending rates, etc. After setting prices, agents engage in a negotiation process. 

The link with urban productivity is made through the land rents distributed through wages and available for distribution. If agents own their own property, they capture the rents. If others own it, they capture the rents.


\subsubsection{Economic Rent}\label{sssec-economic-rent}
The economic rent is the value of the locational services, 
This is a surplus that arise from agglomeration economies that make being close to the city core valuable. \Gls{locational services} are represented as %, on an annual basis, 
the wage premium, $w$, minus the transportation costs, $c$, for a property a given distance, $d$, from the center. That is the value of living in a particular location:
\[\omega- {dc}.\]


\subsubsection{Warranted Rent}\label{sssec-waranted-rent}

%Just as there is a warranted price, there  is 
The economically \gls{warranted rent}, $\mathcal{R}_W$, is the value of all  the services a property offers. % and \gls{market rent}, $\mathcal{R}_M$. The {warranted rent} 
It is the maximum rent  a tenant might pay in rent, since it is the maximum that could be extracted from tenants before they decide they are better off leaving the city.  

In each period a house offers two kinds of services: {locational services} or  access to the central city job, and {home services}.  The {warranted rent} is the value of this double stream of services.  The value of the stream of housing services is the fraction $a$ of the subsistence wage $\psi$ that must be allocated to providing the housing independent of location. 

 The warranted rent is, then, 
\begin{align}
\mathcal{R}_W=\omega- {dc} + a\psi.
\label{eqn-warranted-rent}
\end{align}
 It a kind of limit or \gls{frontier} the market pushes agents towards. It may be thought of as an \gls{equilibrium} or \gls{attractor}. The way this work uses that kind of frontier, drawing on \gls{equilibrium}, \gls{dynamical system}, and \gls{agent-based} traditions of analysis, is treated in detail in the discussion of methodology in Chapter \ref{chapter-methodology}.
 
\subsubsection{Market Rent}\label{Market-Rent}
The \gls{market rent}, $\mathcal{R}_M$, is what agents actually pay. The market rent can in principle differ from the economically warranted rent as individual investors make decisions about rents and setting rents based on their own expectations, which include a wide range of factors. To simplify the model, we assume that the market rent equals the warranted rent. We are in effect imposing a long-term equilibrium value rather than modeling the adjustment process.  %\gls{warranted rent} is paid as the \gls{market rent}
\[\mathcal{R}_M = \mathcal{R}_W.\] 


\subsubsection{Net Rent}\label{Net-Rent}
The \gls{net rent} is the warranted rent net of costs. Homes must be maintained and taxes paid, so an owner would receive, not the total warranted rent, but the net rent after expenses,

\begin{align}
\mathcal{R}_N &= \mathcal{R}_W - \mathcal{O} - \mathcal{T}\\
&= \omega - {dc} + a\psi -  \mathcal{O} - \mathcal{T}, \\
\end{align}
where $\mathcal{O}$ is operating costs and $\mathcal{T}$ is taxes. 



% \begin{quotation}
% a  =  share of subsistence wage  used for land and building e.g. 0.3

% b  = share of share of subsistence wage  used on maintenance e.g. 0.2

% c  = annual tax rate on rent and home  e.g. 12 mills = 0.012
% \end{quotation}

\subsubsection{Annual taxation}

%For computational purposes, we will assume that, that is the warranted price.  
 % assessed value
One cost owners pay on a property is taxes. Municipal property taxes are based on the \gls{appraised value}, which is based, somewhat approximately and with a lag, on the \gls{market price}, $\mathcal{P}_M$. % The appraised value typically lags the market value, and attempts to approximate underlying value, so we approximate it here it with the \gls{warranted price} \cite{apraised_value_refs}. 

\begin{align*}
\mathcal{T} &= \text{mill rate} \times \mathcal{P}_M \\
\end{align*}
where the `\gls{mill rate}' is the municipal tax rate $c$ applied to the Market price.\footnote{In our computations, the mill rate  has to be compounded for decisions made over a period of the mortgage term, so we compound the mill rate $c$ using the the \gls{compound interest rate} for the period. The entirely conventional  computation is described below.} The taxes paid over the period are then:

 We will assume that the market price can be approximated by the present discounted value of warranted  rents,

\begin{align*}
\mathcal{T} &= \text{mill rate} \times \frac{\mathcal{R}_W}{r} \\
&= c \times \frac{\omega- {dc} + a\psi.}{r}
\end{align*}


\subsubsection{Warranted Price}\label{sssec-warranted-price}

We will call the economically justified price, given the urban productivity premium, the \gls{warranted price}, 
The \gls{warranted price} of a house is the present discounted value of the flow of service net of costs: $P_W$. This is the present discounted value of the warranted rents.
\begin{equation}
  P_W=\frac{\mathcal{R}_N}{r},  
\label{eqn-price-warranted}
\end{equation}
where $\mathcal{R}_N$ is the net value of rents, and $r$ is the interest rate.  The warranted price approximates the sale price, of a unit of housing with land, in the absence of potential capital gains. 

\subsubsection{Market Price and Expected Price}\label{sssec-market-price}

The \gls{market price} or the price at which a property is exchanged on the market, $P_M$ may not be known in advance, nor will the future sale price. In order to make decisions, agent $i$ must form an  \glspl{expectation} or   prediction $P_{M_i}^{\epsilon}$ of an as yet unrealized future market price. Agent $i$'s expected market price  may be affected by individual information, biases, preferences, and any assumptions the agent has about the behaviour of others, the system state.

%$P_M^{e}$ expectation based on  either rational expectations or another set of explicitly stated rules,  $P_M^{\epsilon}$ is an agent's expectation. The agent's expectation can  etc.



%In the analysis that follows, we work with an \gls{expected market price} based on the theoretical model developed in this dissertation, $P_M^{e}$.


\subsubsection{Annual maintenance}
Annual maintenance costs apply to buildings and lands but not to locational value,
so we can write
 \begin{align}
\mathcal{R}_N^w &= \omega - {dc}  + a\psi -   ba\psi - c(\omega-{dc}+a\psi) \\
\end{align}
Instead of modelling the rental price formation process explicitly, we abstract from the complexities  of market rent  by using the warranted rent as an approximation. We do this to focus on the economic rent, and to show as clearly and as simply as possible the economic linkages between productivity and urban rents. 
The assumption simplifies the analysis of the relationship between the scaling of urban productivity and the financialized ownership that can extract that value which is part of  the core conceptual contribution of this work. 
 
%and the potential for financialized ownership to extract that value, pushing those who contribute to creating growing wealth, to a subsistence frontier. Formalizing this relationship is part of the core conceptual contribution of this work. %\footnote{***WHERE IS MAIN DISCUSSION OF THIS? ** RENT CHAPTER? .. %METHOD/model/intro section - ref section COULD ELABORATE ON BENEFITS. THIS IS A CORE CONTRIBUTION, WE ARGUE IT IS  WORTHWHILE TO EXPLORE THE LINKAGES BETWEEN PRODUCTION AND EXTRACTION. TO OUR KNOWLEDGE, IT HAS NOT BEEN DONE ELSEWHERE. 
%Future work can explore the way in which this locks those who earn bellow average incomes to fall behind, no matter how much wealth they create, the smaller urban concentration of value may increase the total value produced, but also makes it easier to monopolize land and concentrate in a financialized ownership class, that amplifies whatever advantage it begins with, however small or path dependant, (shared ownership is in a sense an unstable equilibrium, under the conditions of combining urban scaling laws and a land tenure models that allows finacialization)  REFERENCE HERE AND  MOVE/EXPAND DISCUSSION IN FUTURE WORK}.

% In the discussion, refer to the value agents would be willing to pay as the $\mathcal{R}_W$, to make it clear what we are discussion, recognizing that we can vary this and explore the value of different values for rent, the role of expectations, information, amenity, etc.

% This, along with the focus on rents, 

% It is an important assumption in the analysis because it connects the work with the formal analytic tradition and is in an important sense what makes this a classical model MOVE DISCUSSION HERE...
 %METHODOLOGY CHAPTER? warranted rent is a frontier .  


In the computational agent-based  model, the assumption gives a natural way to initialize agent guesses about future rents, as part of the \gls{price formation} process. The values evolve from that starting point. 

% *** LOTS OF NOTES MOSTLY ON AMENITY AND OTHER DIFFERENCES BETWEEN WARRANTED AND MARKET RENTS - NEED A CLEAN PARAGRAPH OR TWO EXPLAINING
%\footnote{The assumption $\mathcal{R}_W = \mathcal{R}_M$ is easy to vary in future experiments, 
% Rents can diverge from warranted rents. In practice, some people may pay more or less than the warranted rent. They may draw on family assets, assume debt, spend more on amenity, etc. Rents are, however, limited by what tenants can pay, and that, in turn, is limited by urban wages. WHERE DO WE MAKE THAT ASSUMPTION.
%including by adding a range of decision rules. 
% Our model of income is incomplete, and people don't only care about the income they earn. Some are paying for the amenity of urban life. In real life, many other factors cans shape amenity value including features of the housing, desire to live near clubs, sports, cafe's libraries, hospitals, neighbours, and family members, the quality of nearby walk, of transit to places they may wish to travel to etc. Appendix \ref{appendix-amenity} includes a theoretical treatment of amenity in the context of the model. People also make choices with imperfect information, some are investing in living in a city
% ADD DISTINCTION BETWEEN REALIZED MARKET RENT AND DIFFERENT KINDS OF EXPECTATIONS --- THEY WONT ACTUALLY BE THE PREDICTION VALUES. THE PREDICTION VALUES ARE WHAT ARE USED. 
% THEY PREDICTION VALUES CAN INCLUDE ERRORS, BIASES, ETC.
% WE USE THE EQUILIBRIUM TO EXPLORE A SET OF FRONTIERS RIGOROUSLY.
% }.
% ADD A FOOTNOTE ABOUT THE DISTINCTION BETWEEN THE VALUE WHICH INCLUDES AMENITY AND THE PRICE PAID?  e.g. if you own the services you capture it - the value experienced can differ from the value paid. - can be subjective, variable, etc, 
% Note the warranted rent is what is econoimcally jsutified, it can vary from the market rent, which is what is actually paid.  
% Talk about unobserved variables, and 
% They really care about what they will get- use decision rules to forcast the actual returns realized. Might guess about the biases of others
% The market rent is what the agent actually pays in rent the property. - they can own a shre and captre some


% The following sections detail the model and explain how each of these terms is derived.
% **TODO ADD NOTES ON TIME IN THE FOLLOWING SECTIONS E.G. ALL RENTS REPRESENTED ON AN ANNUAL BASIS, PRESENT DISCOUNTED VALUE, ETC

% \subsection{Warranted rent} \label{section-warranted-rent}


% \subsubsection{Locational services}
% Since people live in homes inside or outside the city, it's a share of the subsistence wage,  OWNERS CAN ALSO CAPTURE? Maybe move some of the discussion here.

% It is the combined annual services a property, at a distance $d$, offers to a worker in the city. It is thus the maximum that they may be charged.
% CUT? This quantity is a locational rent. The capitalized value of the locational rent is:  $w-{dc}$. This is because a worker, located at a distance $d$ from work, paying as much as $w-{dc}$ in rent would still choose to work.  %Workers could pay that much in rent and additional costs and it would still worthwhile to commute. 
% \subsubsection{Land and building services}
% Annual rent charged initially should be  equal to the annual value of services, $h$:
% and the warranted price is 
% \[P_W=\frac{\omega - {dc} + a\psi}{r}\]
% We will use this value as the price for the first period 
% $P_W=\frac{\omega- {dc} + a\psi}{r}$

%$\mathcal{R}_N$ is the value that investors consider when assessing the \gls{financial return} on property, since it's the maximum that it's worth paying to capture the value renters are wiling to pay to live in a property, given the \gls{urban wage premium}. 
% consider in investment decisions. % of services and costs
% For an investor, it is $\mathcal{R}_N$  that is relevant in investment decisions. % ( - fees, cost of money etc.) decision making. 

% All of these are in annual values. We will use the present values  for the appropriate period  T in computations. (See notes on the present value calculations to use)

% \subsection{NEW WORK STARTS - How does this affect the bid price?}

% I now return to Equations B6 to compute the value of a proposed purchase


% \begin{align*}
% V &= \delta \left(P_T - (1+r)M\right) +      \mathcal{R}^w_N  \tag{B6} \\
%   &= \delta \left((1+\dot P)    - (1+r)m    \right) P_B + \mathcal{R}^w_N%\label{eqn-property-investment-value1}
% \end{align*}
% Similarly, Equation B7 becomes

% \begin{align*}
% r_{return} = \frac{\delta \left(1 + \dot P - (1+r)m\right)}{1-m} + \frac{\mathcal{R}^w_N}{(1-m)^{bid}}\tag{B7}
% \end{align*}
% And following the same sequence of steps to derive the bid price 

% \begin{align*}
% P_i^{bid} \le &   \frac{\mathcal{R}^w_N}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)} \tag{B10}\\
% 		 \le &   \frac{ \omega - dc + a\psi -   ba\psi - ca\psi}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)}	\\	
%    		 \le &   \frac{ \omega - dc + a(1-b-c)\psi}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)}	
% \end{align*}

%Our conclusion about the advantage that the bank and the wealthy have can be read out of this equation. 
%That may let us simplify the exposition in the financialization chapter.


\subsubsection{Size of mortgage available, $m_i$}
\[m_i= \frac{0.25Y_i}{r_i}\]
where $r_i$ is $i$'s cost of capital, $Y_i$ is $i$'s income.

\subsubsection{Cost of capital $r_i$}
The cost of capital is known to differ for rich and poor. Say for example, the cost of borrowing, $r_i$ for agent $i$ if the base lending rate is $\bar{r}$
 \[ r_i = (A + B \frac{\bar{W}}{W_i})\bar r\]
where $\bar{W}$ is mean wealth and $W_i$ is individual wealth. %Figure~\ref{Fig:BorrowingCost} illustrates the effect.

% \begin{figure}[htb]
% \begin{center}
% \input{fig/model-price-of-capital.tex}
% \caption{Hypothetical wealth-dependent borrowing cost}
% \label{Fig:BorrowingCost2}
% \end{center}
% \end{figure}%

This has a number of immediate implications. First, if agents discount at their borrowing rate, wealthier agents a lower discount rate and therefore value properties more highly. 

Second, given the  common rule that mortgage payments cannot exceed some fraction of disposable income, the wealthy will be able borrow larger amounts and at lower interest rates that the less wealthy. At any distance from the centre they will be able to make a higher bid.
 
If the expected return on a property is greater than the individual cost of borrowing, it would pay any agent to borrow as much as possible and purchase properties as they become available.

\section{Bid Price}

The underlying value of a home is the capitalized value of the urban rents, which are perpetual.  Rents, however, depend on urban productivity and may change over time. Any expected increase in future rents capitalized into the market price of a home as a capital gain for the owner. Home prices should respond to expectations.

%We link the housing market model model of individual and institutional actors to the model of production and employment by..
Rents go to the owners of a given property. If workers own their own homes, rents go to them. If others own the land, they can extract the rent. 

The warranted price is not the same as the market price.  The market price can depart from the warranted price when there is price speculation based on expected future values or if agents make errors based on market information.
% There is another distinction:
The warranted value is base on the true value of the services, while the market value can diverge. 
% We do the calculation in terms of warranted values because we will use these to initialize the model. 

The actual market price will be determined by a bidding process that takes into account potential capital gains.  We describe the bid price formulation below. % that process below.

For the sake of the computational model we define housing prices for different purposes and at different stages of the market process. The notation appears in Table \ref{table-price-notation}.



% \renewcommand{\arraystretch}{1.5}
% \begin{tabular}{rlrr}\
% Symbol         & Name                                 & Value      & Formula  \\ \hline
% $\omega$  & Maximum locational rent (wage premium) & 0.012  \\
% $a$       & Share of subsistence wage for land and building & 1.0 \\
% $\psi$    & Subsistence wage & 10000 \\
% $tau$ replace  & Property tax rate &  e.g 1.6\% = 16 mills             & \\
% $c$       & Transportation cost & \\
% $T$       & Period & 5 years      \\
% $r$       & Individual interest rate & 0.05 \\\
% $\tau$       & Tax share & \\

% --        &  & \\
% $\dot P $      & Price growth                         & []         & $\frac{P_t-P_{t-1}}{P_{t-1}}$\\
% % $P^T_e$        & Expected price in T years            &            & $P_0(1+\dot P)^T$ \\ % *** WAS $P^e_T$ 
% $r_i^\delta$   & Individual discount rate             &            & To assign \\
% $\bar r$       & Prime interest rate                  &            & \\
% \end{tabular}
% \renewcommand{\arraystretch}{1.0}

We anchor our housing price expectations in bid rents, which, based on the literature can reasonably be seen as an equilibrium or attractor towards which prices will evolve. 

To model the market transactions when speculative motives are in play we need an expression for how much financial investors will bid. More specifically, we need to find the maximum price that they are willing to pay. As Horowitz \cite{horowitzBiddingModelsHousing1986} notes, a prospective buyer  considering knows a vector of attributes of the house, the sellerâ€™s asking price and the property taxes, transaction costs, and financing costs at a specified price. The  potential buyer also is likely to have estimates of the maintenance costs and resale value of the house, although these may be highly subjective. For our bidding model, therefore, we need find how much financial investors will bid in terms of these variables.

 We assume that agent may be  speculating on potential \glspl{capital gain} as well as on the \gls{use value} or net market rent they get from the property. We therefore treat the purchase as an investment decision and compute a rate of return, $v$, conditional on the price paid. This allows us to solve for the maximum bid, $P_{max}^{bid}$ that achieves the desired rate of return. 
    
 The agent purchases makes a down payment, $D$ on a house for a price, $P_0$, and agrees to payoff a mortgage with interest at the end of the mortgage period. For expositional convenience we can treat the mortgage period $T$ as a single term and express all quantities  in present-value terms. The Agent 
 and receives the increased price $P_T = (1 + \dot P)P_0$, back after a period $T$, Where $\dot P$ is the expected rate of price increase. The agent also receives either the net market rental value of the property, $\mathcal{R}^w_N$, or if the owner is also the resident, the locational rents.




\subsection{The rate of return}
We first calculate the net present value of the purchase, then divide by the amount of capital employed, which we assume is simply the size of the down payment made at the beginning of the period. This gives us a rate of return.\footnote{A common approach would be to calculate an internal rate of return (IRR), but  the IRR is in general the solution to a polynomial and does not guarantee a single-valued result.\cite{robinsonOPTIMALTERMINATIONIRR1996} Multiple real-valued  IRRs may arise;  complex-valued IRRs may arise;  the IRR is, in general, incompatible with the net present value (NPV) in accept/reject decisions; the IRR ranking is, in general, different from the NPV ranking; the IRR criterion is not applicable with variable costs of capital. Ways to salvage the IRR as a usable criterion have been proposed that are consistent with our approach \cite{magniAverageInternalRate2010}, which is to calculate an NPV then convert it to a rate,} 

\begin{eqnarray}
Rate\ of\ return\ on\ capital\ invested = \frac{\delta \left((1+ \dot P_M^e - (1+r)m\right)}{1-m} + \frac{\mathcal{R}_N}{(1-m)P_B}\label{equation-RoR}
\end{eqnarray}
where 

\begin{tabular}{lll}
 $\delta$       &=& individual discount rate \\
$\dot P_M^e $   &=& expected rate of price increase \\
$ r$            &=& mortgage interest rate \\
$m$             &=&  fraction of the price that can be mortgaged \\
$\mathcal{R}_N$ &=&  net  market rent
\end{tabular}
Equation~\ref{equation-RoR} makes it clear that the estimated rate of return depends on subjective magnitudes,$\delta$ and $\dot P_M^e$, attributes of the property, $ \mathcal{R}_N$, and  individual financial position, $r$, $m$.

The individual's Rate of return on capital  invested  for each project  is compared to the investor's target rate, $r_{target}$, providing  an investment criterion:
\begin{eqnarray}
r_{target} \le \frac{\delta \left((1+ \dot P_M^e - (1+r)m\right)}{1-m} + \frac{\mathcal{R}_N}{(1-m)P_B}
\end{eqnarray}
In Appendix~\ref{appendix-bid-price} this expression is solved for $P_B$, the  maximum price that allows the investor can pay and still achieve at least her  target rate of return, $r_{target}$.  

\begin{eqnarray}
P_B & \le    \frac{\mathcal{R}_N}{(1-m)r^{target}-\delta \left(1 + \dot P_M^e - (1+r)m\right)} \label{equation-Bidprice}\end{eqnarray}
% P_B & \le    \frac{\mathcal{R}_N}{(1-m)r^{target}-\left[ \delta(1+L(P)- (1+r)m\right]}
We call this  $i's$ maximum bid and compute it for all potential buyers. In each sale the highest $P_B$ will make the purchase. The denominator can be seen as an adjusted rate of return for capitalizing net rents, analogous to the value of $r$ in  the standard capitalization formula.

The market mechanism then simply has to compare the bid price  $P_B$ with the seller's reservation price and apply a bargaining rule to determine how any surplus is allocated. .% unless there are limits on the size of capital flows. For our simulation, we implement such limits. 

Since  agents do not have perfect information, the calculation is done with their best approximation of values. % The agent does not know the future. 
 The rate of price growth $\dot P$, is an approximation based on rents and past market behaviour.\footnote{Case and Shiller ``..we see a market largely driven by expectations. People seem to form their expectations from past price movements rather than having any knowledge of fundamentals. This means that housing price booms will persist as home buyers become destabilizing speculators.''Case and Schiller, \cite{caseThereBubbleHousing2003}} Details of the derivations, and implementation, are discussed in the Appendix. % We calculate the bid price in Appendix \ref{appendix-bid-price}.

%Thus, the 1-year expectations are fairly well described as attenuated versions of lagged actual 1-year price changes, Case and Schiller, \cite{caseThereBubbleHousing2003} p282

%  GET?? Case, Karl E., and Robert J. Shiller. 1988. â€œThe Behavior of Home Buyers in Boom and Postboom Markets.â€ New England Economic Review (Novemberâ€“ December), pp. 29â€“46.



 \subsection{The value of an investment}
The value of the investment $V$ is therefore the capital gain, minus financing costs, plus the rents, net of operating costs and taxes, $\mathcal{R}_N$.
 
 This may be written in terms of the purchase price, and several individual parameters: interest  rate, share of the price that can be mortgaged and  discount rate:\footnote{The down payment could be deducted in advance, but if the discount rate is equal to the interest rate it drops out completely.}
 
\begin{align}
V &= \delta \left(P_T - (1+r)M\right) +   \mathcal{R}^w_N   \\
&= \delta \left((1+\dot P) P_0 - (1+r)mP_0\right)  +      \mathcal{R}^w_N \\
%V &=& \delta \left(P_T - (1+r)M\right) +  \mathcal{R}^w_N\\
  &= \delta \left((1+\dot P)    - (1+r)m    \right) P_0 + \mathcal{R}^w_N 
\end{align}

This is the net present value of buying, and selling after one planning period. All rates are scaled to the length of the period to avoid the need for compounding calculations. The has 4 individualized  parameters, $\delta$, $\dot p$, $r$, $m$, as well as any factors that affect the rent term.



\subsection{Rate of return on investment}
The rate of return on funds invested is V divided by the size of the down payment, $D$ to get the rate of return  

\begin{align}
r^{return} 
  &= \frac{V}{D}  \nonumber \\
  &= \left(\delta \left(1+\dot P - (1+r)m\right) \ \right) \frac{P_0}{D}  + \frac{\mathcal{R}^w_N }{D}      \nonumber \\
  &= \left(\delta \left(1+\dot P - (1+r)m\right)  \right) \frac{P_0}{P_0-mP_0} +  \frac{\mathcal{R}^w_N }{P_0-mP_0}  \\ 
  &= \frac{\delta \left(1+\dot P - (1+r)m\right) }{1-m} +\frac{\mathcal{R}^w_N }{(1-m)P_0}.
\label{eqn-property-investment-return1}
\end{align}

\subsection{Criterion for investment}
Equation~\ref{eqn-property-investment-return1} provides a criterion for investors. Agents invest if if their expected return is greater than the target return, they are seeking:
\begin{equation}\Large
r^{target}\le v 
\label{eqn-property-investment-return2}
\end{equation}

% So the condition is 
% \begin{align*}
% r^{target} \le \frac{\delta \left(1 + \dot P - (1+r)m\right)}{1-m} + \frac{\mathcal{R}^w_N}{(1-m)P_0^{bid}}\tag{B7}
% \end{align*}

 % THIS  MAY BE NEEDED
% \begin{align*}
% P_{max}^{bid} \le &   \frac{\mathcal{R}^w_N}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)} \tag{B10}\\
% 		 \le &   \frac{ \omega - dc + a\psi -   ba\psi - ca\psi}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)}	\\	
%    		 \le &   \frac{ \omega - dc + a(1-b-c)\psi}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)}	
% \end{align*}

 % We assume that the use value is captured by the stream of rental values. %, whether a home is owner-occupied or held by an investor as a financial asset. 
 % For simplicity, we consider a one-period investment.  %To keep the analysis simple without loss of generality 

%  The agent purchases a house for a price, $P_0$ %a down payment, $D$, 
%  and receives the increased price $P_T = (1 + \dot P)P_0$, back after a period $T$. 
% % The value of the investment is the net present value of buying and then selling after one period:
% The value of the investment is the capital gain, $\mathcal{C}$ plus the rents, net of operating costs and taxes, $\mathcal{R}_N$.

% minus the mortgage, repaid with interest, plus rents, minus any operating costs and taxes,\footnote{We have applied this model to explore the effect of a vacancy tax in Beirut.  For that analysis we  added a use-value, $U$ in place of rent for expatriate owners to represent using the property - say one month a year - when they are not renting the property and a \textbf{vacancy tax}, $T$ at rate $t$ to affect the speculator's  decision.} %\cite{Al-Shihabi}

% OLD equations from working out the above. Could change symbols
% \begin{eqnarray}
% V  	&=& capital\ gain - Interest\ due  	+ Rent  - operating\ cost -taxes \\
% 	&=& \delta P_T-D \qquad \qquad \quad - (1+\delta r)M \quad	 + R  	-C\\
% 	&=& \delta P _T \qquad-(P_0-M) \quad- (1+\delta r)M 	 + R  	-C\\
% 	&=& \delta (1+\dot P)  P_0 -(P_O -M)  -(1+\delta r)mP_0  + R  -C\\
% 	&=& \delta (1+\dot P)  P_0 -P_O + M \qquad -(1+\delta r)mP_0  + R -C\\
% 	&=&( \delta (1+\dot P)-1)  P_0  + mP_0 \quad -(1+ \delta r)mP_0  + (\rho-\kappa)P_0 \\	
% 	&=& \left(  \delta (1+\dot P)-1    + m \quad - m(1+\delta r)  + (\rho-\kappa)\right)P_0 \\'
% 	&=& \left(  \delta (1+\dot P)-1    + m \quad - m-\delta rm  + (\rho-\kappa)\right)P_0
% \end{eqnarray}
 % Where $\mathcal{R}$, $\mathcal{O}$, $\mathcal{T}$, and $M$ are total rent, operating costs, tax payments, and mortgage borrowed, as net present values at the end of the period. The interest rate is $r$, and the discount factor $\delta$. % I don't like this. I think it makes sense for them to be total payments over the period, but I now think it would be more intuitive to compute them as net present values at the start of the period, since that is when the mortgage is borrowed and the decision is made.

 %For ease of calculation, ..To get the return on investment, 
%  This may be written in terms of shares of the purchase price:
% \begin{eqnarray}
% V &=& \delta \left((1+\dot P) P_0 - (1+r)mP_0\right) + \rho P_0 - \theta P_0 - \tau P_0 \nonumber \\
%   &=& \left(\delta \left(1+\dot P - (1+r)m   \right) + \rho     - \theta     - \tau\right) P_0.
% \label{eqn-property-investment-value2}
% \end{eqnarray}
%  Where $\rho$, $\theta$, $\tau$, and $m$ are rent, operating costs, taxes, and mortgage shares, respectively. % Where $\phi$ is a fraction that takes into account taxes and operating costs. 
 % of price for rents, operating costs, and taxes. %The discount factor is $delta$, $P_0$ is the property price at the time of sale. %$r$ is the interest rate paid, and $m$ is the share of the price taken out as a mortgage.
 %It has  seven  parameters, $\delta, \dot P, r, m, \rho, \kappa$ and $t$. The first four, $\delta, \dot P, r$ and $m$ are exogenous for the investor while $\rho$, $\kappa$ and $t$  are    %Operating revenue and costs $\rho, \kappa$ and $t$ are expressed as  present values. 

%Agents borrow a share of the purchase price, $P$. The amount borrowed is the mortgage, $M$. This is a share of the total purchase price $mP = M$. The \gls{mortgage term}, $T$, is the period it takes to pay down the mortgage.

%\section{Return on investment}

% The rate of return on funds invested, $r_{return}$, is the value divided by the size of the down payment, $D$: 
% %The rate of return is $v = \frac{V}{D}$. %For expat investors, we get a \textbf{decision rule}:
% %\begin{enumerate}
% %\item  if $v \geq a$ (with some private use?) with no rent,  don't bother renting. 
% %\item If $v(no\ rent\ and\ tax) < a\geq v(with\ rent)$,  then  rent. 
% %\item If $ v(with\ rent) \le a $,  then sell 
% %\end{enumerate}\
% \begin{eqnarray}
% r^{return} 
%   &=& \frac{V}{D}  \nonumber \\
%   &=& \left(\delta \left(1+\dot P - (1+r)m\right) \ + \rho - \theta - \tau \right) \frac{P_0}{D}        \nonumber \\
%   &=& \left(\delta \left(1+\dot P - (1+r)m\right) \ + \rho - \theta - \tau \right) \frac{P_0}{P_0-mP_0} \nonumber \\ 
%   &=& \frac{\delta \left(1+\dot P - (1+r)m\right) \ + \rho - \theta - \tau }{1-m}.
% \label{eqn-property-investment-return1}
% \end{eqnarray}
% Equation~\ref{eqn-property-investment-return1} provides a criterion for investors. Agents invest if if their expected return is greater than the target return, they are seeking:
% \begin{equation}
% r^{return} \geq r^{target}. 
% \label{eqn-property-investment-return2}
% \end{equation}

%This is the maximum price that satisfies the criterion $r^{return} \geq r^{target}$.  The bid price is used in the price determination process in our model. %Where the return is the value over the down payment:
% Equation \ref{eqn-property-investment-return1} expresses the expected return on investment in terms of the  market price, $P_0$: 
% \begin{eqnarray*}
%  r^{return} 
%    &=& \frac{V}{D} \\
%    &=& \frac{\delta \left(1+\dot P - (1+r)m\right) \ + \rho - \theta - \tau}{1-m}.
% \end{eqnarray*}
%which we define as the ``bid price'',% $P_B$ $P^{max}_{bid}$. 
%We return to Equation~\ref{eqn-property-investment-value3} %
%We start by writing the value of the investment, from Equation \ref{eqn-property-investment-value1}, with the net rent. %, which can be written a share, $\phi$ of total rent $\mathcal{R}_N = \phi \mathcal{R}$, %The net rent can also be written as a share, $\phi$, of the rent 
%: %(originally from Chapter \ref{chapter-financialization} on Financialization. Since the rent is a known quantity at the beginning of the term, independent of the current, so we reformulate net rent,  $\mathcal{R}$, $\mathcal{O}$, $\mathcal{T}$ as a fraction of total rent: 

% \begin{eqnarray}
% V &=& \delta \left(P_T - (1+r)M\right) +      \mathcal{R}_N   \nonumber \\
%   % &=& \delta \left(P_T - (1+r)M\right) + \mathcal{R}_N   \nonumber \\
%   % &=& \delta \left(P_T - (1+r)m P_0\right) + \mathcal{R}_N \nonumber \\
%   &=& \delta \left((1+\dot P)P_0 - (1+r)m P_0\right)     + \mathcal{R}_N \nonumber \\
%   &=& \delta \left((1+\dot P)    - (1+r)m    \right) P_0 + \mathcal{R}_N
% \label{eqn-property-investment-value3}
% \end{eqnarray}


% Dividing by the down payment, $D = (1-m)P_0$:
% \begin{eqnarray}
% r_{return} = \frac{\delta \left(1 + \dot P - (1+r)m\right)}{1-m} + \frac{\mathcal{R}_N}{(1-m)P_0}
% \end{eqnarray}

% +++++++++++++++ JUST REPLACED BETWEEN THESE WITH THE ABOVE. CHECK IT'S OKAY
% % We also have to assume that $P_B = P_M$, which we can justify as an equilibrium condition - investors believe they are paying the market price. The result is 
% % \[V= \delta(P^T- (1+r)M)   +\phi r P_B\]

% % The price at the end of the term $T$, $P_T$, is a predicted value for the investor \textit{ex-ante}, so we can replace $P^T$ in Equation~\ref{eqn-property-investment-value3} with the predictor, $(1+\dot P)P_B$. 
% % We can replace $P^T$ in Equation~\ref{eqn-property-investment-value3} with $(1+\dot P)P_0$.
% \[V= \delta \left((1+\dot P)P_0 - (1+r)m P_0\right) +\phi \mathcal{R}\] 
% Then we replace $\dot P$ with an estimate, $L(P)$, representing an estimated function of the lagged values of $P$ and any  other relevant data. We imagine the potential investor informed estimates by information from  real estate agents or analysts.  The result is 
% \[V= \delta \left((1+L(P))P_B- (1+r)mP_B\right) +\phi \mathcal{R}\]
% Combining terms:
% \[V= \delta \left((1+L(P))- (1+r)m \right) P_B +\phi \mathcal{R}\]

% WHY BIG BRACKETS NOT SHOWING UP

% The rate of return $r_{return}=V/D=V/(1-m)P_B$ is then

% \[r_{return}= \frac{\delta \left((1+L(P) - (1+r)m\right)}{1-m} + \frac{\phi \mathcal{R}}{(1-m)P_B}\]

% %++++++++++++++++

% \begin{align}  
%   v  & =  \frac{\delta ((1+\dot P)  - (1+r)m)\  + \psi r}{1-m}\label{eq:RULE}\\
%   & =  \frac{\delta ((1+\dot P)  - (1+r)m)\  + \psi r}{1-m}\label{eq:RULE}
% \end{align}

% \begin{eqnarray}
% v %&=& \delta(P^T- (1+r)M) \qquad \qquad \qquad 	 + \mathcal{R}_N \nonumber\\
% % &=&\delta\left( (1+\dot P)P_B - (1+r)mP_B \right)  + \mathcal{R}_N  \nonumber\\
%   &=&\delta\left( (1+L(p)) - (1+r)m \right) P_B + \mathcal{R}_N  \nonumber
% \end{eqnarray}

\subsection{Maximum bid} % given the rate of return

Agents bid if the RHS is larger than the target rate of return, as stated in Equation \ref{eqn-property-investment-return2}.  $P_0$ with $P_B$, and $\dot P$ with an estimator for $\dot P$, we get: %TO DO REPLACE PDOT - MAYBE WITH TILDE AND DOT..: 

\begin{eqnarray}
r_{target} \le \frac{\delta \left((1+ \dot P_M^e - (1+r)m\right)}{1-m} + \frac{\mathcal{R}_N}{(1-m)P_B}
\end{eqnarray}

Solving for $P_{bid}$:

\begin{align}
r^{target} &\le \frac{\delta \left(1 + \dot P_M^e - (1+r)m\right)}{1-m}   +\frac{\mathcal{R}_N}{(1-m)P_B}. \nonumber \\
(1-m)r^{target} &\le \ \ \delta \left(1 + \dot P_M^e - (1+r)m\right) + \frac{\mathcal{R}_N}{P_B} \nonumber \\ %\delta(1+L(P))- (1+r)m%
(1-m)r^{target} - \delta \left(1 + \dot P_M^e - (1+r)m\right)  &\le  \frac{\mathcal{R}_N}{P_B} \nonumber\\
P_B & \le    \frac{\mathcal{R}_N}{(1-m)r^{target}-\delta \left(1 + \dot P_M^e - (1+r)m\right)} 
% P_B & \le    \frac{\mathcal{R}_N}{(1-m)r^{target}-\left[ \delta(1+L(P)- (1+r)m\right]} \nonumber 
\label{eqn-bid-price1}
\end{align}
The denominator is an adjusted rate of return for capitalizing net rents, analogous to the value of $r$ in Equation~\ref{eqn-price-warranted}. 

Each agent has their own interest rates, discount rates, mortgage share, information, and expectations, so individual bids can differ.

% \begin{align}
% P_i^{bid} \le   \frac{\mathcal{R}_N}{(1-m_i)r_i^{target} - \delta_i \left(1 + L(P) - (1+r_i)m_i \right)}.
% \label{eqn-bid-price2}
% \end{align}

% \begin{eqnarray}%. OLD VERSION: WRONG
% %r^{target}&=& \delta\left( (1+L(p)) - (1+r)m \right) P^{max}_{bid} + \mathcal{R}_N  \nonumber\\
%    P_{max_bid} &=&\frac{r^{target} - \mathcal{R}_N}{\delta\left((1+L(p)) - (1+r)m \right)} %\label{EqBidPrice2} 
% \end{eqnarray}

% \section{Finding bid price}
% We start with Equation~\ref{B2}. for convenience, replace $\rho -\kappa - \sigma $ with $\mathcal{R}_N$ (net Rent). 

% Replace $P^T$ with $(1+\dot P)P_B$ assuming that the bidder is bidding the equilibrium market price for the period.

% Then replace   $\dot P$ with $L(p)$ representing some (estimated function ($\tilde{\dot P}$)) of the lagged values of $P$ that incorporates other data. 

% \begin{eqnarray}
% v&=& \delta(P^T- (1+r)M) \qquad \qquad \qquad 	 + \mathcal{R}_N \nonumber\\
%  &=&\delta\left( (1+\dot P)P_B - (1+r)mP_B \right)  + \mathcal{R}_N  \nonumber\\
%   &=&\delta\left( (1+L(p)) - (1+r)m \right) P_B + \mathcal{R}_N  \nonumber
% \end{eqnarray}

% So I want to use this relationship to find the maximum bid price for the bank. The rule is, ``Bid if the RHS is larger than the target rate of return, $r^{target}$, and do not bid if it is smaller.''  The maximum bid  is the bid that makes the two sides equal. 

% {\color{red}
% \begin{eqnarray}
% r^{target}&=& \delta\left( (1+L(p)) - (1+r)m \right) P^{max}_{bid} + \mathcal{R}_N  \nonumber\\
%    P^{max}_{bid} &=&\frac{r^{target}-\mathcal{R}_N}{\delta\left( (1+L(p)) - (1+r)m \right)} \label{EqBidPrice} 
% \end{eqnarray}}
% %(What makes. this work is that I do not use an identity to get $\dot P$, which made the system of equations singular.)
% \newpage

\subsection{The cost of capital}
The cost of capital is known to differ for rich and poor. This model ties the individual cost of capital,  $r_i$ for agent $i$, to a prime rate, $\bar r$ , and to individual wealth. Figure~\ref{Fig:BorrowingCost} illustrates the cost of the borrowing model we implement, 
 \[ r_i = (A + B \frac{\bar{W}}{W_i})\omega\]
Where $\bar{W}$ is mean wealth and $W_i$ is individual wealth. 
\begin{figure}[htb]
\begin{center}
\input{fig/price_of_capital.tex}% Figure of cost of borrowing
\caption{Borrowing cost for  $A=1$  $B=0.5$ (blue);  $A=1$  $B=0.8$ (red);  $A=.8$  $B=0.8$ (green);}
\label{Fig:CapitalCost}
\end{center}
\end{figure}
If the expected return on a property is greater than the individual cost of borrowing, it would pay any agent to borrow as much as possible and purchase properties as they can available.\footnote{As pointed out previously,  Equation~\ref{Eqn:DecisionRule} implies a `bang-bang' control - with all sales going to the richest participant unless there are limits on the size of capital flows. For our simulation, we implement such limits. } 
 
The borrowing of most agents will be constrained. A common rule is that mortgage payments cannot exceed some fraction of disposable income. The wealthy will be able borrow larger amounts and at lower interest rates than the less wealthy. 

%The model has been set up so that all of a workers's  income is spent on  basic living costs, $\omega$, transportation $td$ or rent. Disposable income for agent $i$ is therefore just the return  $\omega W_i$ on  financial assets.  


\section{The period and time value of money}
In developing the model we introduced a number of rates, such as $r_i$, the rate that individual $i$ pays for a single borrowing period. The payment calculation is made for a period of length $T$, which we refer to as a mortgage term.
%This means the actual interest paid is a compounded interest rates (VARIABLES LIST FOR THIS).

%In developing the theoretical model we introduced a number of rates, such as $r_i$, the rate that  individual $i$ pays for a single period of borrowing. We assume the calculations are for a  period of length  $T$, which we refer to as a mortgage term. This means that the rates in equations such XXXXX are actually compounded rates.
Taking a simplified example, if the rate is $x$/year, interest payments are $xM$, a share of the total mortgage amount borrowed, $M$, for each of $T$ years. 
If the interest payments are all made at the end of the mortgage term, the lender will require interest on the deferred interest, so agent $i$'s payment at the end of the period $T$ will be:

\begin{align*}
\text{Payment} &= (1+r_i)M                                 \\ 
    &= M + xM(1+x)^{T-1}+ xM(1+x)^{T-2}\dots + xM(1+x)^{0} \\
    &= M\left(1+ x\sum_{z=T-1}^0(1+x)^{z}\right).          \\ 
\end{align*}
Therefore, the interest payment is:
\begin{align*}
r_i.   &=x\sum_{z=T-1}^0(1+x)^{z}.
\end{align*}

For the sake of notational simplicity and clarity of exposition,  we omit the compounding formula throughout our discussion. This means that, while banks may quote a per period interest rates, the equations use a compounded rate. In the computational model we employ the appropriately compounded values. All %the rates are compounded in this way to provide a per-period rates, including all 
 the interest rates, the $r$'s, are compounded in this way, because they require annual or monthly payments at their stated rates.
 It does not affect the discount rates, the $\delta$'s, or the borrowing ratio $m_i$, because they are initially calculated for the term and don't require the same period payments.
 The discount factor $\delta_i$ is always a compounded version of $x$:
 \[\delta_i=\left(\frac{1}{1+x}\right)^T\].
%is a feature of the individual, so it is not affected in this way.
%The appropriate compunding expressions for other rates are displayed below.

 The {mortgage term}, $T$, is the period after which the mortgage must be repaid with interest. We work with a mortgage terms for two reasons. First, in the theoretical analysis, by transforming the multi-period transaction to a single period, we simplify the comprehensibility of the analysis. Second, it reflects the fact that in practice agents  likely consider the profitability of a purchase for a finite term longer than one period. The term period lets them consider the time cost of money in their analysis in a natural way. Parameters for their discounting rates and the term considered can be used to explore the effect of borrowing costs and their personal discounting rates on their decisions. Future interest rates are also not fully known. In the future, we can also vary the compound interest rates to explore the impact of uncertainty, given agents' guesses about the future, and their level of risk aversion.

\section{The owner's decision to sell}
We will assume, at least initially, that for owners, deciding to sell is a life-cycle decision: home owners-workers  reach the end of their working lives, no longer need access to the central city, and put their homes on the market, making room for new workers to enter the urban market.\footnote{The timing decision can be randomized, but that is highly unlikely to affect results. On the other hand, 
\color{red}
if worker-owners remain in their homes after retirement, there are fewer homes available for new workers, which must produce a labour shortage in this model, driving up wages, leading to higher bids and rising home prices, which in turn attracts  speculative bidding. This will only accelerate any shift in the ownership pattern. Our core model suppresses labour market dynamics and the effect of housing shortages to focus on the warranted prices, which are driven by aggregation economies. 
\color{black}} 
\footnote{\color{blue}As a second step, we may allow potential buyers  to approach potential sellers who have not listed with an offer and allow worker-owners to consider retiring early or becoming tenants if an offer is attractive.  This is only likely if speculative pressures are strong. It may require having multiple institutional buyers to make offers more competitive. In that case initial offers will be closer to the maximum bid price, tending to pull prices up and benefit potential sellers.\color{black}}  

Worker-owners in the final few years of their working life may decide to  list if  they notice that the expected price posted by the real estate agent, $P_M^e$,  exceeds (say) 95\% of their reservation price. This is a `hopeful' listing, `fishing' for an offer that exceeds the actual reservation price.

\[P^{ask}>P_M^e> 0.95 P^r\]
Otherwise
\[P^{ask}> 0.10P^r>P_M^e\]
If no offer exceeds the reservation price, no sale is made.

Once an owner reached retirement age, if no sale is made the reservation price is reduced for the next cycle.

If no sale is made the owner considers becoming a landlord. if the present value of net rent is above the reservation price, the owner rents out the home. .

\section{REDUNDANT Financialized capital}
%Individuals and institutions play a role in the housing market through credit markets and direct investment.Agent's access credit shapes worker's ability to purchase homes. Credit is offered by institutions.
% Agents may be able to foresee future growth. %They may even over invest if they follow market trends and bubbles form. 
% They can claim a share of the urban wealth as it grows over time by owning the land. 

%If the return on housing investments is competitive with alternative investments, capital from institutions and individuals will flow into housing. Institutional investors can purchase housing.  Individual households can also allocate a larger share to housing to capture the returns.
% If the return on investment in housing is competitive with alternative investments, can purchase housing for it's financial return. They can rent housing and sell the asset with appreciation later. We examine the conditions in which this increased demand can drive up prices in the market. 
% Capturing future growth of the city, depending on their foresight - how much does it take to block individuals from gains-- Regime.
% both institutional investors and individual agents can purchase additional housing for it it's return on investment even though they don't need it as a place to live. 
% Use value vs rent value. 
%Institutional investors can purchase housing as an investment. Individuals with more wealth may invest 
Households may, for example purchase a larger house than they need, purchasing additional units to rent out, or keep a house after retiring rather than downsizing.  % and individuals with sufficient means can purchase larger homes than they need to benefit from appreciation, or purchase additional units to rent to others. 
% Investors can also purchase housing to claim a share of the future productivity of the city. Individuals and groups can put extra money into housing. Institutional housing providers can buy up the housing supply.
% HYPOTHESIS FEEDBACK LOOP -- FINANCIALIZED INVESTMENT --
%The rise in spending on housing as a proportion of income can be driven by both rising prices (cutting into quality of life) and increasing investment to claim a share of the returns.  -- disaggregate and show the geometry -
% Test how linear is this relationship? 

% \subsubsection{Size of mortgage available, $m_i$}
% \[m_i= \frac{0.25Y_i}{r_i}\]
% where $r_i$ is $i$'s cost of capital, $Y_i$ is $i$'s income.

% \subsubsection{Cost of capital $r_i$}
% The cost of capital is known to differ for rich and poor. Say for example, the cost of borrowing, $r_i$ for agent $i$ if the base lending rate is $\bar{r}$
%  \[ r_i = (A + B \frac{\bar{W}}{W_i})\bar r\]
% where $\bar{W}$ is mean wealth and $W_i$ is individual wealth. %Figure~\ref{Fig:BorrowingCost} illustrates the effect.

% % \begin{figure}[htb]
% % \begin{center}
% % \input{fig/model-price-of-capital.tex}
% % \caption{Hypothetical wealth-dependent borrowing cost}
% % \label{Fig:BorrowingCost2}
% % \end{center}
% % \end{figure}%

% This has a number of immediate implications. First, if agents discount at their borrowing rate, wealthier agents a lower discount rate and therefore value properties more highly. 

% Second, given the  common rule that mortgage payments cannot exceed some fraction of disposable income, the wealthy will be able borrow larger amounts and at lower interest rates that the less wealthy. At any distance from the centre they will be able to make a higher bid.
 
% If the expected return on a property is greater than the individual cost of borrowing, it would pay any agent to borrow as much as possible and purchase properties as they become available.

\subsubsection{The rate of return on a property purchase $v$}
To explore the implication of the financialization of the urban land market we need a function to calculate the return on a unit of land that reflects the actual gradient of opportunity in financial markets. We begin with the price appreciation, $\Delta P=P_T-P_0 = (1+\dot p)P_0-P_0 $, where $\dot p$ is the rate of price appreciation over the period $T$. Rates will all be specified for the period $T$. Transaction costs, including real estate fees, take a fraction from the value of the final sale.

 The speculator invests a down payment, $D$, and gets back at time $T$ the  increased price $(1+\dot p)P_0$, plus rents, minus any costs and minus the mortgage with interest.
%footnote{We can include a use value, $U$ in place of rent for expatriate owners to represent using the property - say one month a year - when they are not renting the property and a \textbf{vacancy tax},
%$T$ at rate $t$ to affect the speculator's  decision.
 
The rate of return is the value of the gain, $V$,  over the size of the downpayment, $D$, where
\begin{equation}https://quoteinvestigator.com/2015/08/30/practice/
V =capital\ gain - Interest\ due  	+ Rent  - operating\ cost\    
\end{equation}

The rate of return is $v = \frac{V}{D}$. 

Both the  share of the price  that can be mortgaged, $m$, and the interest rate  and $r$ may be functions of the agent's wealth. $\delta$ represents the net capital gains tax. It makes it possible to capture the capital gains kept. If it is set to one, it simplifies the equations, all is kept. Keeping the variable offers a policy variable to control the return on financial capital.

\begin{eqnarray*}
V  %	&=& capital\ gain - Interest\ due  	+ Rent  - operating\ cost\\
% 	&=& \delta P_T-D \qquad \qquad \quad - (1+\delta r)M \quad	 + R  	-C\\
% 	&=& \delta P _T \qquad-(P_0-M) \quad- (1+\delta r)M 	 + R  	-C\\
%	&=& \delta (1+\dot p)  P_0 -(P_O -M)  -(1+\delta r)mP_0  + R  -C\\
%	&=& \delta (1+\dot p)  P_0 -P_O + M \qquad -(1+\delta r)mP_0  + R -C\\
%	&=&( \delta (1+\dot p)-1)  P_0  + mP_0 \quad -(1+ \delta r)mP_0  + (\rho-\kappa)P_0\\	
%	&=& \left(  \delta (1+\dot p)-1    + m \quad - m(1+\delta r)  + (\rho-\kappa)\right)P_0\\'
%	&=& \left(  \delta (1+\dot p)-1    + m \quad - m-\delta rm  + (\rho-\kappa)\right)P_0\\
&=& \delta(P_T- (1+r)M) \qquad \qquad 	 + R  	-C   - T\\
&=& \delta((1+\dot p)  P_0- (1+r)mP_0)   + \rho P_0  	-\kappa P_0 - tP_0\\
&=&( \delta((1+\dot p)  - (1+r)m) \ + \rho   	-\kappa -t) P_0
\end{eqnarray*}

This is the  net present value of buying, and selling after one period. \textbf{It has  6 exogenous parameters}. Operating revenue and costs $ \rho -\kappa - t$ a present value. 

The rate of return is $v = \frac{V}{D}$. For expat investors, we get a \textbf{decision rule}:\begin{enumerate}
\item  if $v \geq a$ (with some private use?) with no rent,  don't bother renting. 
\item If $v(no\ rent\ and\ tax) < a\leq v(with\ rent)$,  then  rent. 
\item If $ v(with\ rent) \le a $,  then sell 
\end{enumerate}

We can, with some simplifications, write
\begin{eqnarray}
\frac{V}{D}&=&( \delta((1+\dot p)  - (1+r)m) \ + \rho   	-\kappa - t ) \frac{P_0}{D}   \nonumber\\
		&=&( \delta((1+\dot p)  - (1+r)m) \ + \rho   	-\kappa - t ) \frac{P_0}{P_0-mP_0}   \nonumber\\
		&=&\frac{ \delta(1+\dot p  - (1+r)m) \ + \rho   	-\kappa - t } {1-m} \label{Eqn:DecisionRule}
\end{eqnarray}

\subsubsection{Returns on capital are higher for wealthy investors}
\begin{figure}[htb]
\begin{center}
\input{fig/model_price_of_capital.tex}
\caption{Hypothetical wealth-dependent borrowing cost}
\label{Fig:BorrowingCost}
\end{center}
\end{figure}%



\section{IMPLEMENTATION: Relating the market model to the code}
The chapter links the theory to the output of the simulations. %is intended to explain the code and justify the modeling decisions that link the theory to the actual 


\section{MOVE UP? Bargaining - The market process and bargaining}
We consider a homogeneous city with a single wage, identical preferences, uniform identical transportation costs, identical lot sizes.

Individuals and institutions buy and sell properties given individual goals, resources and available information.

% The process can be summarized as
The model of the market process includes the following steps:
The core machinery of the model is the market process. At the centre of that process is a model of price formation and bargaining. % bargaining model. 

\begin{enumerate}
    \item Identify the set of sellers for the current cycle. This may include:
    \begin{enumerate}
        \item people retiring in this cycle,
        \item people who retired and failed to sell, and potentially
        \item people approaching retirement who might consider selling early and
        \item financialized owners. % the bank? speculative owners? .
    \end{enumerate}
    
    \item For each seller, calculate the expected property price: % \textbf{from real estate agent}:
    \begin{enumerate}
        \item Initialize with the warranted price, which is the value of the stream of services, provided by the property. Rents minus net costs:
       \[ P_W=\frac{(\omega-{dc}) + {a}\psi}{r}\]
        The value of the house is the rent premium minus the cost of transportation. Subtract the costs of running the house, divided by the interest rate
    
        IS IT MINUS A $\psi$ SINCE HIGHER COSTS LOWER PRICES?
       
        {\color{green} This is the expected warranted price. It might make sense just to use the homeowner's reservation price (maximum bid price)}.
        \item in later cycles use the actual transaction price $P_M$ (with inflation added) when it is available, or use a (regression)estimate $P_{it}^e$ the real estate agent.
    \end{enumerate}
    
    \item for each seller, compute a reservation price using a variant of the maximum bid price formula. 
    {\color{green}\textit{Values like $m_i$ are going to be expected values for others.  ??? }}
    \textit{This is what the seller thinks she should get, taking into account her expectations about the price increase etc..}
    
    \item for each seller, compute an asking price. 
    \textit{Add some percentage to the reservation price. Make sure the result is above ***? $P_M^e$, since you know you might have to come down in bargaining.}   
    
    \item for each seller, list the asking price for bidders to see.
    
    \item for each property, identify a set of potential bidders.
    \begin{enumerate}
        \item Bank considers bidding on all listed properties.
        the formula is the maximum bid price with its own parameters putting in the current rents.
        \item New entrants to labour market
       {\color{yellow} \item Retirees who might sell, move out of town and invest in a rental property}
    \end{enumerate}
    
    \item for each bidder, compute a maximum price using a variant of the bid price formula. 
    
    \item for each bidder, compute an initial bid no higher than  the maximum price. 
    \color{red}  
    \textbf{(there may be two paths to consider: working from initial bids, or working with max bids )}
    
    \item With list of max bids, check to see if any exceed the asking price. 
    \begin{enumerate}
        \item If yes settle on asking price if there is just one, and the second highest max bid if there are more than one.
        \item If no, proceed.
    \end{enumerate}
    
    \item With list of max bids, check to see if any exceed the reservation price. 
    \begin{enumerate}
        \item If no, house is not sold, and reservation price is reduced for the next cycle.
        \item if one max exceeds the reservation price,  split the difference between the reservation price and the maximum bid bid.
        \item if more than one max exceeds the reservation price, choose the second highest max bid if there are more than one
    \end{enumerate} 
\end{enumerate} \color{black}


-----

All agents have access to the price forecast, $P_M^e$, from the real estate agent.

We have five categories of potential buyers.\footnote{Types three and four  would  become landlords if the transaction is completed, which is a change of class status.} 
\begin{enumerate}
    \item newcomers to the city, who have a job offer  and seek to buy a home or become tenants.  
    \item financial investors who possess financial capital and seek a rate of return better than they would receive from alternative investments. We refer to this investor as `the bank'
    \item owner-occupiers who might mortgage their current homes  to purchase a revenue property
    \item owner-workers who retire and might  invest in a revenue property rather than spending  their capital gain 
    \item sellers are also default buyers, since they can buy their own home and rent it out if their \gls{reservation price} is not met.  
\end{enumerate}


For potential sellers the maximum bid price is also the `\gls{reservation price}' price.  
\[P^{ask}> P^r, \qquad   P^{offer}< P^{max}\]


All potential buyers and potential sellers  will calculate a \gls{maximum bid price} or reservation price and and an initial offer price or ask price \gls{bid  price}. 

The initial bid price (offer) will be lower than the potential buyers maximum bid price. The initial ask price will be higher than the reservation price.

Bargaining will occur when the maximum bid price of at least one agent exceeds the reservation price of the listing agent.

Transactions can occur when the maximum bid price of at least one agent exceeds the reservation price of the listing agent.


\subsection{Determining initial offer and ask prices}

Agents can calculate their maximum bid  or their  reservation price. 
These values are not public. We need to identify initial ask and offer prices, which is the way they appear in the market.


\[P^{ask}> P^r> P_M^e\] 

If the posted expected price exceeds their \gls{reservation price} they 
\begin{enumerate}
    \item list  the property for sale.with the real estate age,nt.
    \item select and asking price   
\end{enumerate}

The bank posts a \gls{maximum bid function} with the real estate agent.

In practice, potential investors will make an  initial  bid that is lower than this value and subsequent bargaining will settle of a price between the initial bid and the seller's asking price.

In the market, the initial bid should be smaller than the bid price calculated, which is a maximum that can earn the target rate of return, The bank will definitely go this high. 

If there is a  max bid among competing buyers, the second highest max bid should be the sale price, but the bidder with the highest max bid wins the property. This is realistic because in a bidding war the final bid only has to be a very small amount higher than that of the last competitor left.
That is the highest price that a seller can get.

 %This  seems realistic enough and is very simple to implement. It should producer a path that is indistinguishable form any more complex approach. 

% Will persons retiring who would leave the city invest in an urban rental?



% But what is $D$? Does the bank have unlimited funds? Isn't D just a fraction of P?  If so it cancels out
% r is the prime rate- that the bank pays? 



% \begin{verbatim}
% \end{verbatim}

\section{Computing values for bid and warranted price}

In the following sections we discuss % the computation of agents' bid price, outline potential discounting approaches, and discussing 
how each component of the calculation is treated in the code. %, organizing the discussion following Equation~\ref{eqn-bid-price2}:


\begin{align}
P_i^{bid} \le   \frac{\mathcal{R}_N}{(1-m_i)r_i^{target}- \delta_i \left(1+L(P)- (1+ r_i)m_i\right)}.
\end{align}
Net rent, $\mathcal{R}_N$, is discussed in section \ref{SS:NetRent}. 

Interest rates, discount rates, and borrowing ratios are discussed in section \ref{SS:RatesAndRatios},
The borrowing ratio, $m_i$, is discussed in section \ref{SS:BorrowingRatio}, the target interest rate, $r_i^{target}$, is discussed in \ref{SS:targetr} the discount factor, $\delta_i$ is discussed in section \ref{SS:discountfactor}. The price approximation mechanism, $L(P)$ is discussed in \ref{SS:PriceForecast}, and the interest rate the buyer has to pay for the mortgage, $r_i$, is discussed in \ref{SS:BankRate}. Sections are thus numbered: 

\begin{align*}
P_i^{bid} \ge   \frac{\ref{SS:NetRent}} {(1-\ref{SS:BorrowingRatio})\ref{SS:targetr}-
\left[ \ref{SS:discountfactor}(1+\ref{SS:PriceForecast}- (1+\ref{SS:BankRate})\ref{SS:YWealthConstraint})\right]}. 
\end{align*}


\section{CODE DISCUSSION}
present value of tax on propriety over T years. 

\section{Operating cost calculations}
\begin{verbatim}
property value * tau * (sum_(1-T) ((1/(1+r))^t).    
    (sum_(1-T) ((delta_t)

psi   = 100000 # subsistence wage
    
#  Annual operating cost in dollars  
#  eg psi=100000 b=.02 , a*b*psi= 2000 per year 

 compounded for 5 years Must add the discount factors  
 \delta_t for five years 
 \[ oppcost=  \[\frac{\omega+a\phi}{r} \tau + a\phi b\right]\sum_1^T \frac{1}{1+r}\]
 a*b*psi/.r - (a*b*psi/r)*delta_T
#  eg   2000/.r - (2000/r)*delta_T 
= 2000/0.05 - (2000/0/05)*delta_T = 8658.953

opperating_cost = a*b*psi/r - (a*b*psi/r)*delta_T 
\end{verbatim}

\[ oppcost=  \left(\tau\omega  +(\tau+b)a\psi\right)\sum_1^T \left(\frac{1}{1+r}\right)^t\]

\begin{verbatim}
    opperating_cost = (tau*(omega-c*d) + (tau+b) *a*psi)* sum((1/r)^t for t in range(1, T))
    
This is (tax on rent plus both tax and maintenance on the house and land) for (T years with discounting for each year),
\end{verbatim}



----


The relationship between income and consumption is suppressed, because that makes xyz.. so much clearer.

because it ignores
but the relationship

but the relation ship between x and y is not..

don't care what they do in retirement, so ignoring it, so they're still capturing capital gains so long as they own a house
t
their lifetime income is changing even though their current income is not.

--
renters get none of that.



$delta_T$ 
$sum_delta_T$
% $sum_r_T$

$r_T$  present value of total interest payments made over period T




${a}$  =  share of subsistence wage  used for land and building e.g. 0.3

${b}$  = share of share of subsistence wage  used on maintenance e.g. 0.2

${c}$  = annual tax rate on rent and home  e.g. 12 mills 


a     share of subsistence wage  used for land and building

b      share of share of subsistence wage used for maintaining home

c    annual tax rate on rent and home  eg  1.6\% = 16 mills, 1.2\% =.12 mills

% Sigma is tax share, what is the tax rate.
% delta is density ** - - infinitesmal density increase as the city moves out. [[adjustment speed for wage N]] imagine a density function over the city. 

\section{SORT Housing services 30 percent}
MOVE TO ASSUMPTIONS - We assume households spend a fixed fraction $a$ of their subsistence wage $\psi$ on housing. 

\footnote{***JUSTIFY ASSUMPTION OF FIXED SHARE OF SUBSISTENCE HERE? This appears to be empirically justified and simplifies the model \cite{GET_SOURCE_HOUSING_A_FIXED_SHARE_SUBSISTENCE_WAGE}. Appendix \ref{appendix-future-work} considers how the assumption may be relaxed in future work.}

Housing services absorb about 30\% of income  we will use than number  as an approximation,  $a\psi$, where $a$ is the share of the subsistence wage and $\psi$

Note, this is a simplification. It ignores any locational values of the house, as well as the costs stream, it is a net cost, but a net cost embedded in the share of the income. It is a justified simplification, but an interesting place to explore the effect of adding nuance.  MAYBE MOVE DISCUSSION OF POTENTIAL EXTENSIONS TO FUTURE WORK.

\section{Net rent}\label{SS:NetRent}
We assume that the present value of the rent % $\mathcal{R}$ 
is known to an investor in advance. We can imagine the investors' accountant having information on the rent that the market will bear or on prior rents and including this information in the calculation of $P_B$.

Uncertainty can be represented as bias or stochasticity.
Calculation notes: I have rent from the wages. I have kappa and sigma from our ex parameter values. . omega from the wages. 

Net rent, which can be written a share, $\phi$ of total rent $\mathcal{R}_N = \phi \mathcal{R}$
$\mathcal{R}_N = \phi \mathcal{R}$

Where the \gls{rent share}, phi is a fraction
$\phi = (rent-taxes-costs) /rent$ 

There's a distinction between the warranted rent, the net rent, and the rent that's actually charged.

We assume that the  rent  actually charged to a tenant is the warranted economic rent, ($\mathcal{R}= \omega - {dc}$), but the relevant term to enter into the calculation of return on investment is the net rent $\mathcal{R}_N$ for a given property, because the returns are the returns an investor can get after paying taxes and operating costs.

In our computational model, we do the calculation in terms of a mortgage, so we want the total returns after expenses, in present value, compounded over the mortgage  period.
% We want the total returns after expenses, in present value, compounded over a 5 year period.

\begin{align}
\mathcal{R}_N &= \mathcal{R} - \mathcal{O} - \mathcal{T} 
\end{align}

In terms of the warranted rent, 
\begin{align}
\mathcal{R}_N &= (1-\kappa_j - \sigma_j)(\omega - {dc}) % was {d_j} here
\end{align}


% $\mathcal{R}_N = (1-\kappa_j - \sigma_j) (\omega - {c} d_j)$

% {\color{red}
% Notice that  we need here is really the fraction of the warranted rent that the owner gets to keep after maintenance costs and taxes. It is possible that the owner is charging more or less than the economic  rent, but economic rent can be seen as an equilibrium value. Economic rent is $\mathcal{R}$.  This is (tautologically) related to the price as a fraction of the actual sale price: COULD MOVE TO THE CHAPTER NOW SINCE THE THE SECTION IS MOVED THER
% }
% \[\mathcal{R}= \frac{\mathcal{R}}{P_0}P_0 \]

If we want to know the  present value  of the \textbf{net rent}, $\mathcal{R}_N$  collect over the period  $T$, $\mathcal{R}_N^T$, we \textbf{add up} the discounted rents for each year. We may assume the rents are rising at and that the first is the current warranted rent, which gives us a computational formula. 
\[\mathcal{R}_N^T= (\omega-dc)\sum_{t=0}^{t=T-1} \frac{(1+\dot{\mathcal{R}})^{t}} {(1+r_{r_\delta})^{t+1}} \]

% \[\mathcal{R}_Nj^T= (\omega-dc_j)\sum_{\tau=0}^{\tau=T-1}\left[\frac{1+\dot{\mathcal{R}}}{1+r_{r_\delta}}\right]^\tau \]
\noindent where $\dot{\mathcal{R}}$ is an expected rate of change of rents - possibly zero for now, and $r_\delta$ is the individual's discount rate. 

TODO: problem - how to handle subscripts with net rent $\mathcal{R}_N$


\subsection{Tax ratio}\label{SS:TaxRatio} 
The tax ratio $\sigma$ is the share of rents that the municipality takes for services and infrastructure. This fraction of the value of the property is about 30\% based on mill rates in Ontario,  so $\sigma = 0.3$. % REFERENCE

*** CHECK Total taxes paid on  property $j$, over a given mortgage period $T$ is 

\[\Psi_j^T = \psi * \mathcal{R}\].  

    %\href{https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwiOmNPUvIL9AhUUmokEHX-5C9oQFnoECBIQAQ&url=https%3A%2F%2Fwww.greatersudbury.ca%2Fcity-hall%2Ftax-services%2Fpdf-documents%2F2022-tax-rates%2F&usg=AOvVaw2XEdfcC5z-5AqfOeH5t-eN}{Sudbury values}  same as https://www.greatersudbury.ca/city-hall/tax-services/pdf-documents/2022-tax-rates/

\subsection{Cost tax ratio}\label{SS:CostRatio} 
The value of $\kappa$  varies for every property based on maintenance requirements, historic rents, tenant rights, and variations in assessed values. If it varies, it may be useful as a quality indicator.

%Values for $\kappa$ and $\sigma$ must be adjusted to take into account the length of the period or net rents have to be summed over the period.  NO LONGER NEEDED 

Nothing prevents $\sigma+\kappa >1$, which would leave an investor unable to cover building maintenance and taxes out of current rent. 


\section{Income and wealth effects}
\subsection{Interest rates, discount rates and borrowing ratios} \label{SS:RatesAndRatios}

According to the Canada Housing Statistics Program (CHSP), first time home buyers require a combination of sufficient income and savings in order to enter the housing market. (insert tables? from the CHSP?) We have implemented these facts by making interest rates and mortgage share depend on income and wealth.
% image.png

% image.png
% https://www150.statcan.gc.ca/n1/pub/46-28-0001/2023001/article/00001-eng.htm

% Investors now make up more than 25\% of Ontario homebuyers, pushing prices higher, experts warn. 2020

% Released: 2022-04-12

% New data from the Canadian Housing Statistics Program (CHSP) show the extent of inequalities in housing: multiple-property owners possess nearly one-third of all residential properties and the top 10\% wealthiest owners account for around one-quarter of residential housing value. Despite these inequalities, new data show an increase in the number of first-time home buyers from 2018 to 2019.
% Both income and housing wealth are concentrated at the top, even among owners. When ordering individual owners by their yearly incomes, the top 10% of owners in Ontario and British Columbia each had yearly incomes above $125,000.
 

\subsection{Borrowing ratio} \label{SS:BorrowingRatio}
$m_i$

The borrowing ratio, $m_i$, is just the fraction of the price that the bank will lend to a potential buyer. \textbf{It may depend on the individual.} 

Income(\ref{SS:YWealthConstraint}) and/or wealth (\ref {SS:MWealthConstraint}) may constrain individual participation in markets. 
Here we should use the same logic as we use about the interest rate charged. (\ref{SS:BorowingRate})

It is likely to be higher for institutional buyers  and for the wealthy because the bank thinks those with assets are more secure risks. they may have other assets that could be attached in the case of default.
(note interventions with reduces interest rates, or loan assessments drawing on techniques used by foundations could have value)


\subsection{Target interest rate}\label{SS:targetr}

 The target interest rate, $r^{target}$, is the prime rate plus a margin. % required by the bank.  Question: do non-bank actors have such a term?

\begin{verbatim}
self.get-target-interest-rate(buyer)
\end{verbatim}



\subsection{Discount factor}\label{SS:discountfactor}

The discount factor $\delta_i$ for THE END OF period $T$ captures the cost of waiting $T$ periods to sell the property. The usual way to treat it, which we use here, is to assume that $i$ has an interest rate $r_i$ and has been investing efficiently. This means that  the individual has a discount factor for future returns based on the year-over-year rate of return. 

\[\delta^T_i=\left[\frac{1}{1+r_i}\right]^T\]



\subsection{Price forecast approximation} \label{SS:PriceForecast}
$L(p)$

$p$ is all the price data plus any exogenous information (e.g. policy knowledge?). $L(p)$ is an estimation function that produces a `common knowledge' value for the rate of price increase. Later you can add idiosyncratic extra knowledge or extra ignorance.

Some spatial regression references:
'taxonomy of spatial econometric model specifications that incorporate spatial externalities in various ways'
\cite{anselinSpatialExternalitiesSpatial2003},  
overviews of econometric methods and computational tools \cite{anselinModernSpatialEconometrics2014}, \cite{gelmanDataAnalysisUsing2006}.

\subsection{Prime interest rate}\label{SS:BankRate}
$r$

The bank's interest rate, $r$, is just the bank rate (prime rate? set by the Bank of Canada. Exogenous. Just assign  a value like 4\%.

\subsection{Wealth constraint on m} \label{SS:MWealthConstraint}

We can define individual wealth as:
\[W_i= P_i -M_i  +S_i\]
where 

\begin{tabular}{ll}
$P_i$ & value of owned home\\
$M_i$ & Mortgage on owned home\\
$S_i$ & personal savings = $age*d*W$\\
\end{tabular}

The availability of capital differs for rich and poor. 


We can develop an expression to capture the relationship between the \gls{borrowing ratio}, $m_i$,  and individual wealth. Figure~\ref{Fig:Borrowingratio} illustrates a mortgage availability  model that is written:

 \[ m_i = \frac{0.1 \left(9-\left(\frac{W_i}{\bar W}\right)^{0.5}l\right)}{2} \]

 
Where $\bar{W}$ is mean wealth and $W_i$ is individual wealth. 
The relationship is clearly established empirically \cite{}, but location and shape of the curve may vary somewhat. The curve is parameterized, here, so that the bank has a borrowing ratio close to one, perhaps 0.9, since it has many assets. The borrowing ratio for the median wealth holder, perhaps 0.8.


% TODO *** why two axis labels? - and need to label y axis properly

\begin{figure}[htb]
\begin{tikzpicture}[scale=.5]
%\def\bndmax{5}        %https://tex.stackexchange.com/questions/68462/filling-a-complex-region-with-tikz
%\def\bndmin{0.2}
\def\Y{10}  % height of y axis pecent
\def\W{20}  % length  of x axis
\def\Wbar{4}
\def\rbar{8}% this is the prime rate

% %Equation   \[ r_i = (A + .5 \frac{\bar{W}}{W_i})\omega\]
   % \def\Wmin{.63}  %This sets the lower limit fo the 
    \def\Wmin{(\B*\Wbar)/(\Y/\rbar-\A)} %function to keep in in bounds
	
 \tikzset{func/.style={thick,color=blue!90}}	

 \draw [thick](\W,\Y)-- (0,\Y)node[left=.5cm]{\Large$1$}node[above=.25cm]{$m_i$} -- (0,0)node[left=.5cm]{\Large$0$}--(\W,0)node[below]{Wealth}--cycle;  	% Axes box
 
 \draw [dashed, thick] (0,\rbar) -- (\W,\rbar);  	% Axes
\draw [thick,dashed] ( \Wbar,0)node[below=.5cm]{$\bar{W}$} -- (\Wbar,\Y);  	% Axes

\foreach \yi in {0,...,\Y} \draw (0,\yi)--(-.1,\yi)node[left]{\small$\yi$};
%\foreach \yi in {0,2,4,6,8,10} \draw (0,\yi)--(-.1,\yi));
%node[left]{\small$\yi$};
%\foreach \yi in {0,2,4,6,8,10}node at (-.1,yi) {{10*yi}} ;
\draw[func,domain=0:\W] plot [samples=200] (\x,(9-\x^.5/2);

 \end{tikzpicture}
\caption{Individual borrowing ratio $m_i$ as a function of wealth (in tenths)}
 \label{Fig:Borrowingratio}
\end{figure}


\subsubsection{Individualized borrowing rates}\label{SS:BorowingRate}
 
 
 $r_i$ depends on relative income and assets, as well as base interest rates. % compared to others. 
 The median after-tax income of Canadian families and unattached individuals was \$66,800Â inÂ 2020 according to Statistics Canada's %\href{https://www150.statcan.gc.ca/n1/daily-quotidien/220323/dq220323a-eng.htm}{Canadian Income Survey, 2020}.  \href{https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1110005501}
 Data released in 2020 by Statistics Canada indicates that the top 1\% of Canadians made, on average, around \$512,000 in a single year \cite{WEB_model-stats-can-canadian-incomes}. % \href{https://www150.statcan.gc.ca/n1/daily-quotidien/201222/dq201222b-eng.htm}{Survey of Financial Security, 2019}.

 A study by Statistics Canada found that the typical Canadian household now has a median net worth of \$329,900, while the average net worth in Canada is \$738,200 \cite{WEB-model-stats-can-median-net-worth}.  %\href{https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1110005501}{High income tax filers in Canada}

\subsubsection{Computing the income constraint on interest rates}\label{SS:YWealthConstraint}
$r_i$

In our model, we  tie the individual cost of capital,  $r_i$ for agent $i$, to a prime rate, $\bar r$ or the bank's target rate, $r^{target}$, prime plus 1\%, say. and to individual wealth. Figures~\ref{Fig:Borrowingrate1} and ref{Fig:Borrowingrate1} illustrate a couple of possible  cost-of-borrowing models roughly consistent  with the stylized facts about lenders. 

\begin{align}
 r_i =  &  \left(A + B \frac{\bar{W}}{W_i}\right) \bar r       \label{eq:incomeandr1}  \\
 r_i =  &  \left(\bar r - A + B *\frac{\bar W}{W_i - C}\right) \label{eq:incomeandr2}  \\
\end{align}
Where $\Bar{W}$ is mean wealth and $W_i$ is individual wealth. In Equation~\ref{eq:incomeandr2},  A determines y-shift, B, the scale, and C the  x-shift for the curve.


\begin{figure}
\begin{tikzpicture}[scale=.5]
%\def\bndmax{5} % https://tex.stackexchange.com/questions/68462/filling-a-complex-region-with-tikz
%\def\bndmin{0.2}
\def \Y {10}    % height of y axis as a pecent
\def \W {20}    % length  of x axis
\def \Wbar {3}  % mean wealth
\def \rbar {3}  % the prime rate 

% Equation   \[ r_i = (A + .5 \frac{\bar{W}}{W_i})\omega\]
\def \Wmin{.63}  %This sets the lower limit fo the 
\def \Wmin{(\B*\Wbar)/(\Y/\rbar-\A)} %function to keep in in bounds
\tikzset{func/.style={thick}}	

% Axes
\draw [thick] (0,\Y)node[left=.5cm]{$r_i$} -- (0,0)--(\W,0)node[below]{Wealth};  
\foreach \yi in {0,...,\Y} \draw (0,\yi)--(-.1,\yi)node[left]{\small$\yi$};
\draw [thick] (0,\rbar)node[left=.5cm]{$\bar r$} -- (\W,\rbar);  	% Axes
\draw [thick,dashed] ( \Wbar,0)node[below=.5cm]{$\bar{W}$} -- (\Wbar,\Y);  	% 

\def \A {1.0}  \def \B {0.5} %BLUE
\draw[func,domain=\Wmin:\W, color=blue!90] plot [samples=200] (\x,{(\A+\B*\Wbar/\x)*\rbar});
\draw [ultra thick, color=blue!70 ](13, 8.3)--(15,8.3)node [right, black] {\small A=\A,\ B=\B};

\def \A {0.5} 
\def \B {0.5} % GREEN
\draw[func,domain=\Wmin:\W, color=green] plot [samples=200] (\x,{(\A+\B*\Wbar/\x)*\rbar});
\draw [thick,  color=green](13, 7.6)--(15,7.6)node [right, black] {\small A=\A, B=\B};

\def \A {1.0}  \def \B {0.8} % RED
\draw[func,domain=\Wmin:\W, red] plot [samples=200] (\x,{(\A+\B*\Wbar/\x)*\rbar});
\draw [thick,  color=red](13, 9)--(15,9)node [right, black] {\small A=\A,\ B=\B};
% KEY
\end{tikzpicture}
\caption{Individual borrowing cost as a function of wealth}
\label{Fig:Borrowingrate1}
\end{figure}


\begin{figure}
\begin{tikzpicture}[scale=.5]
%\def\bndmax{5}        %https://tex.stackexchange.com/questions/68462/filling-a-complex-region-with-tikz
%\def\bndmin{0.2}
\def \Y {10}  % height of y axis pecent
\def \W {20}  % length  of x axis
\def \Wbar {3} % meam wealth
\def \rbar {3}% this is the prime rate 

%\def \Wmin{(\B*\Wbar)/(\Y/\rbar-\A)} %function to keep in in bounds
\tikzset{func/.style={thick}}	
	% Axes
\draw [thick] (0,\Y)node[left=.5cm]{$r_i$} -- (0,0)--(\W,0)node[below]{Wealth};  
\foreach \yi in {0,...,\Y} \draw (0,\yi)--(-.1,\yi)node[left]{\small$\yi$};
\draw [thick] (0,\rbar)node[left=.5cm]{$\bar r$} -- (\W,\rbar);  	% Axes
\draw [thick,dashed] ( \Wbar,0)node[below=.5cm]{$\bar{W}$} -- (\Wbar,\Y);  	% 

\def \A {1} %vertical shift aroung \rbar, the prime rate
 \def \B {1}  % Scales the exponential curveBLUE
 \def \C {1}  %right shift  
% \def \Wmin {.4+\B}  %This sets the lower limit fo the 
\def \Wmin {(\B*\Wbar)/(\Y-\rbar+\A) +\C} %function to keep in in bounds

\draw[func,domain=\Wmin:\W, color=blue!90] plot [samples=200] (\x,{\rbar-\A+\B*\Wbar/(\x-\C))});
\node  [align=left, text width =2cm ] at (13, 8.3) {\small y-shift=\A \newline scale=\B \newline x-shift= \C};

 \end{tikzpicture}
\caption{Individual borrowing cost as a function of wealth II}
\label{Fig:Borrowingrate2}
\end{figure}

The rates $\delta,\ \sigma,$ and $r$ depend on the period, $T$. 

\subsection{Incorporating growth and discounting}
%We need a time period T for calculations. For use in any calculation, 

With a price-growth rate of $\dot P$ per year, the growth over $T$ years is $(1+\dot P)^T$, and  %and a 5 year mortgage period, 
the expected price at the end of the period is:

\[P_M^{Te}=P_0(1+\dot P)^T\]

If, for example price growth is 10\%, $\dot P= 0.1$, the {capital gain}, or growth, over a 5-year mortgage term is 0.61051 $\approx$ 60\% of the original price, $P_0$.

If we want the compounded interest rate person $i$ the term T,
\[r_i^T=(1+r_i)^T\]
% This is the value we use in equation~\ref{EqBidPrice}.

If person $i$  discounts at a discount rate $r^\delta$, the present value of a receipt at time $t$ is calculated by using the \textbf{discount factor} $\delta_i^T$.

\[\delta_i^T= \left( \frac{1}{1+r_\delta} \right)^T \]
%\[\delta_i^T= \sum_{\tau=0}^{\tau=T}\left( \frac{1}{1+r_\delta} \right)^\tau \]
 
These can be combined into a function %\delta that  gives a single discounting factor  for a value  like future price that is both growing and being discounted over several (T) periods:
\[ PDV(P_M^{Te})=P_0\left( \frac{1+\dot P}{1+r_\delta} \right)^T \]
This PDV function specifically combines any expected rent increase, the individual's discount rate and the mortgage term into a single operation.

\subsection{Mortgage availability}
For home loans, many personal finance experts recommend total housing costs account for less than 28\% of your \textbf{gross} household income, This gives us an \textbf{income-based  mortgage maximum} of \[M^{max}_Yi = \frac{0.28*(\omega+w)}{r_i}\] It is the maximum the bank will let you pay.

We assume $r_i$ is based on the individual's assets, on relative wealth. Where is it calculated for the householder or the bank?

We get a \textbf{price-based mortgage maximum} \[M^{max}_P = 0.8P_0\] where $P_0$ is the actual sale price. This is based on the maximum amount of risk that the bank is willing to take on. ($P_0$  will not always be the same as the asking price or the warranted price.)

\subsection{SORT Cobb-Douglas constant fraction of income on housing}
It is convenient in this model to use a \gls{Cobb-Douglas} utility function that has the property that a fixed fraction of income is spent on housing.  We can start with the assumption that earnings are fixed for the lifetime at the one-period wage, $w$. Then total spending on housing is $\beta Y, \beta <1$ and $ Y=w$. Let the transportation cost for a specific location $l$ be $T(l)$. The  equilibrium price at that location will be $P(l)= \beta Y-T(l)$.

\section{SORT: Miscellaneous calculations about rates over time}
$delta(0)=1$  for funds received now

Lets calculate $S$, $\delta$ at time infinity:
*** Why?

\[\delta(t)=\left(\frac{1}{1+r}\right)^t\]

\begin{align}
delta (1)   &= 1/(1+r) \\
delta (t)   &= (1/(1+r))^t \\
delta (\infty)   &= \sum_0^\infty\left(1/(1+r)\right)^t\\ 
Let\ a=1/(1+r)&<1\\
delta (\infty)   &= \sum_0^\infty a^t\\ 
S               &= \sum_0^\infty a^t\\ 
               &= 1+a+a^2+a^3+a^4 \dots\\ 
S-aS             &= 1\\ 
S             &= 1/(1-a)\\ 
S             &= \frac{1}{1-\frac{1}{1+r}}\\ % subing r back in for a 
             &= \frac{1}{1-\frac{1}{1+r}}\\ 
             &= \frac{1}{\frac{1+r-1}{1+r}}\\ 
              &= \frac{1}{\frac{r}{1+r}}\\ 
             &= \frac{1+r}{r}
\end{align}
This is the case where you get paid at the beginning of the first period. Rent might be paid in advance for each month. .

For  the case where you get pay at the end of the first period. Interest on a loan  might be paid this way.  summing from t=1 this time, we get $S-aS =a$, and $S = a/(1-a)= \frac{1}{r}$. 

 

%\[\delta(t)= \delta(1)^t =\left(\frac{1}{1+r}\right)^t\]

Finally, we need an expression for the sum of a finite  series to T.  Doing the derivation to check my logic, notice that  omega, psi, c  and a are constants that can be factored out in the following,(\textbf{THIS IS THE WRONG PROPERTY VALUE}
%\[\left(c*\omega + c*a*\psi \right) ->c\left(\omega-trans\ d + a\psi \right)\]
\begin{align}%
    tax&= \sum_{t=0}^{T-1} \delta(t) \left(c*\omega + c*a*\psi \right)\\
        &= c(\omega + a\psi)\sum_{t=0}^T  \delta_t\\
        &= c(\omega + a\psi)(\delta_1+\delta_2 \dots \delta_T)\\
        &= c(\omega + a\psi) \left(\sum_0^\infty \delta_t-\sum_{T}^\infty \delta_t\right)\\
        &= c(\omega + a\psi) \left(\frac{1+r}{r}  - \left(\frac{1}{1+r}\right)^{T+1} \left(\frac{1+r}{r} \right) \right)\\
        &= c(\omega + a\psi) \frac{1+r}{r}\left(1  - \left(\frac{1}{1+r}\right)^{T+1} \right)
%      &=& c(\omega + a\psi)\delta_T\\
\end{align}








\section{Table of Parameter Values}

\renewcommand{\arraystretch}{1.5}
\begin{tabular}{rlrr}\
Symbol         & Name                                 & Value      & Formula  \\ \hline
$a$ replace    & Share of $\psi$ for land and building &   0.3         & \\
$b$ replace    & Share of $\psi$ for maintenance       &   0.2         & \\
$tau$ replace  & Property tax rate &  e.g 1.6\% = 16 mills             & \\
$c$       & Transportation cost & \\
$T$       & Period & 5 years      \\
$r$       & Individual interest rate & 0.05 \\
$\omega$  & Locational rent & 0.012  \\
$\psi$    & Subsistence wage & 10000 \\
$a$       & Share of subsistence wage for land and building & 1.0 \\
$\tau$       & Tax share & \\

--        &  & \\
$m_i$          & Individual borrowing-ratio           & 0.75-0.85  & $M/P^{ask?}$ \\
$M^{max}_Yi$.  & Maximum mortgage based on income     &            & $\frac{0.28(\omega+w)}{r_i}$ \\
 $M^{max}_P$   & Maximum mortgage based on the price  &            & $0.8*P_0$ \\
$IS$           & Income share for housing debt        & 0.25-0.35  & Missing? \\
$\rho$         & Rent ratio                           &            & $\frac{\omega-tau*d_i}{P_0}$ \\
$\kappa $      & Operations ratio                     & 0.1-0.3    & e.g. $ 0.2\frac{\omega-tau*d_i}{P_0}$ \\
$\sigma$       & Tax ratio                            & 0.25-0.35  & e.g. $ 0.3\frac{\omega-tau*d_i}{P_0}$ \\
$\dot P $      & Price growth                         & []         & $\frac{P_t-P_{t-1}}{P_{t-1}}$\\
% $P^T_e$        & Expected price in T years            &            & $P_0(1+\dot P)^T$ \\ % *** WAS $P^e_T$ 
$r_i^\delta$   & Individual discount rate             &            & To assign \\
$\bar r$       & Prime interest rate                  &            & \\
$r_i$          & Individual borrowing-rate            &            & \\
$r^{target}$   & Target interest rate                 &            & $\bar r + margin$ \\
$\delta_i$     & Discount factor for T                &            & $\left(\frac{1}{1+r_i^\delta}\right)^T$ \\


\end{tabular}
\renewcommand{\arraystretch}{1.0}




discount rate vs discount factor

% delta(0)=1  delta (1)= 1/(1+r) 
\[\delta(t)=\left(\frac{1}{1+r}\right)^t\]
    $delta_T=  (1/(1+r))^T$   at T years
    eg r=.05  T=5  delta5 =  $(1/(1+.05))^5 = 0.7835262$


\section{Notation Table}
% \section{Notation for Urban and Production Sectors}
\begin{longtable}{lp{10cm}}
\caption{Notation}                       \\

\hline           &  \textbf{Productivity} \\ \hline
$K$              &  Capital               \\ 
% $L$            &  Labour                \\
$N$              &  Population, equals labour \\ %, $L$          
%$\Lambda$    &  Labour-augmenting agglomeration effect \\
$Y=A K^{\alpha }N^{\beta }$  &  a Cobb-Douglas Production function \\ %Urban output            \\
$\alpha$         &  Elasticity of output with respect to capital          \\
$\beta$          &  Elasticity of output with respect to labour           \\ % vs effective labour
$\gamma$         &  Elasticity of agglomeration with respect to labour    \\ % , $\Lambda(n)$, for illustration \\

% $L$              &  Labour supply \\ %the number of workers, which, in the standard circular city model, equals the number of lots of size $s$  when workers live on identical individual lots. % Unless $d^{max}>d^*$ v  \frac{\pi}{s}(\frac{w}{{c}})^2 =
$n$  &  Number of workers \\
% $n_i$  &  Number of workers employed by firm $i$ \\
%$n=\sum_i n_i$  &  Number of workers, the urban population in the model \\
% $\#f=\frac{n}{n_i}$&number of identical firms \\ %not used
% $f$  &  Number of firms =1 \\
% $n =f n_i$  &  Aggregate labour \\
% $n^\gamma$ & The labour-augmenting agglomeration effect,  modelled as an exponential function of the number of people \\
% $\Lambda(n)n_i$ &  Effective labour for firm $i$ \\
% $\Lambda'=\die{\Lambda(n)}{n} $ & Derivative of the labour-augmenting agglomeration effect\\

%%$Y_i=K_i^{\alpha }(\Lambda(n)n_i)^{\beta }$  &  Urban firm $i$'s output \\

%%$Y=\frac{n}{n_i}K_i^{\alpha }(\Lambda(\sum_i n_i)n_i)^{\beta }$  &  Aggregate output of all firms in the city \\
% $\die{Y}{n}=\beta\frac{1}{n} Y  \left( 1+ \frac{n\Lambda'}{\Lambda} \right)$  &  Social marginal product of labour \\
% $Y_i=K_i^{\alpha }(\Lambda(n)n_i)^{\beta }$    &  Urban firm $i$'s output \\
% $\die{Y_i}{K_i}	=\alpha \frac{1}{K_i} Y_i $  & Marginal product of capital for firm $i$ \\
% $\die{Y_i}{n_i}	=  \beta\frac{1}{n_i} Y_i $  &  Marginal product of labour for firm $i$ \\
%%$\eta=\frac{n_i\Lambda'}{\Lambda}$  &   Marginal agglomeration effect on a firm's output of increasing it's own labour stock \\
% \hline
	% &\textbf{Amenity}\\ \hline
% $A(d, n)$   &  Agglomeration amenity          \\

\hline  0 &  \textbf{Labour market}                \\ \hline %and urban stucture??
$\psi$            &  Rural wage                             \\  
$\omega$            &  Urban wage premium          \\
${c}$             &  Transportation cost per unit distance \\ % Was $\tau$, and $trans$. Considered $\gamma, \xi, \zeta$.
$d$             &  Distance from city centre   \\
$d^* = w/{c}$    &  City extent \\ %, the maximum distance commuters will travel \\ % Maximum distance commuters will travel \\ % to get the wage premium \\
% $\mathcal{R} = \omega - {dc}$ &  Rent at distance ${d}$ \\ 
% $\zeta$          &  Population density at distance $d$     \\
% $s$              &  Lot size      \\
% $\psi$  &  ?Per-period cost of a unit of productive capital \\
% $\omega + \psi$  &  Urban wage including rural wage \\ %***
% $\textit{t}$ & {\color{red}transportation cost per km} \\%use   c?
% $w^n=\omega-{dc}$ & Wage  premium net of transportation costs \\
%% $\Omega=\frac{\omega+\psi}{\psi}$  &  Ratio of the urban wage to the  cost of capital \\
%% $\Pi$	   &  Profit \\
%% $ER$	   &  Excess return to capital \\ 
% \hline &\textbf{Spatial structure in the circular city} \\ \hline		
%% $d^{max} = \omega /{c}$  &  Maximum distance commuters at which residents enjoy the urban amenity \\
%% $d^{**} = max(d^*, d^{max})$  &  radius of the city \\
%% $U$                     &  Worker utility **\\ %, a function of location and prices \\
%% $U^{urban}=U^{rural} $  &  Migration equilibrium assumption ** \\
% \hline & \textbf{Labour market} \\ 

\hline           & \textbf{Financial market}             \\ \hline
$P_W$            &  Warranted price for a property       \\
$P_B$            &  Bid price                            \\ % was P^{bid}
$P_A$            &  Asking price                         \\
$P_M$            &  Realized market price                \\
$P_M^e$          &  Expected market price                \\
% $P$            &  Price of a property                  \\ 
% $\dot P$       &  Rate of price growth              \\ % was $\dot p$  
$\mathcal{C}$    &  Capital gains                     \\ % was C
$\mathcal{C}_N$  &  Net capital gain, $C -$ net rent  \\
$M$              &  Mortgage                          \\ 
$m$              &  Mortgage share                    \\ 
$\mathcal{R}$    &  Rent                              \\
$\mathcal{R}_N$  &  Net rent                          \\
${R}^w_N$        &  Warranted rent                    \\
$\rho$           &  Rent ratio                        \\
$\phi$           &  \Gls{rent share}                  \\
$\mathcal{O}$    &  Operational costs                 \\
$\theta$         &  Operations ratio                  \\ % was $\kappa$
$\mathcal{T}$    &  Taxes                             \\ % was $\Sigma, \Xi$  
$\tau$           &  Property tax share                \\ % was t then $\sigma, \xi$
$r$              &  Interest rate                     \\
$\delta$         &  \Gls{discount factor}             \\
% $W$            &  Wealth                            \\
% $\psi$         &  Fraction with rent/operating costs\\
$t$              &  Time                              \\
$T$              &  Time period                       \\

$a$ replace      &  Share of subsistence wage  used for land and building \\
$b$ replace      &  Share of share of subsistence wage used for maintaining home \\ % A cost. Includes water, electricity, heat? 
$tau$            &  Annual tax rate on rent and home \\ % Was $c$

\hline
\color{black}
\end{longtable}  

\newpage

\begin{longtable}{lp{10cm}}
\caption{Rent}                                                            \\
\hline
$\omega-{dc}$                &  Warranted (economic) rent                \\
$\mathcal{R}=\omega-{dc}$    &  Equilibrium rent payment of tenant       \\
PDV                           &  Present discounted value                 \\  
$\mathcal{R}^T$               &  PDV of rent collected over period $T$    \\ 
$\mathcal{R}^T_N=(1-\kappa-\sigma)\mathcal{R}^T$  &  PDV of net rent collected over period $T$ \\
\hline
\end{longtable}

\begin{longtable}{lp{10cm}}
\caption{Bidding mechanism notation}                                          \\
\hline
$\mathcal{R}_N$  &  Net rent                                                  \\ % was NR
% $P_0$            &  Purchase price for a property                             \\
% $P^T_e$          &  Expected price at the end of period $T$                   \\
$\bar r$         &  Prime interest rate                                       \\
$r^{target}$     &  Investor or banks target interest rate, $\bar r + margin$ \\
$r_i$            &  Agent $i$'s personal borrowing rate                       \\
$r_i^T$          &  Agent $i$ interest rate compounded over a period $T$      \\
$r_i^{disc}$     &  Agent $i$'s subjective discount rate (which may equal $r_i$) \\
$r_\delta$       &  Discount rate                                             \\ % was $discr_i$
$\delta_i^T$     &  Discount factor for agent $i$ over period $T$             \\
$m^W$            &  Wealth-based share of home price a worker can mortgage    \\ % $= m_i(W_i)$
$m^\omega$       &  Income-based share of home price a worker can mortgage    \\ % IS_i   IS_i(\omega+\psi)$$
$m_i = min(m^W_i, m^\omega_i)$  & Mortgage, the share of home price worker $i$ can mortgage \\

\hline
\color{black}
\end{longtable}  

Notation: 
Agent counts and indices are subscripts.
Values related to time are superscripts, time as a continuous 
variable is small, a period is capitalized e.g. the period $T$ of some number of years. 
In general values are capitals, rates are small letters.

It might be better to use the subscript $m$ for `market'.  for warranted rents

\section{Additional Assumptions}
\begin{enumerate}
\item There is full employment, no frictional unemployment, and no labour adjustment costs.
\item Firms set output and factor inputs to maximize profits, so factors are paid the value of their marginal private product
\item Demand for output is perfectly elastic (constant price = 1)
\end{enumerate}


Rural producers pay a wage $\psi$. this covers a standard house, lot, entertainment, diet and consumption pattern. We  choose units so that per-period cost of a unit of productive capital is also $\psi$


\chapter{MODEL PARTS CUT FROM BACKGROUND CHAPTERS}

\section{GROWTH}

\section{Equilibrium city size and the scale factor} 
At this point, we can briefly describe how the discussion of this chapter relates to our overall modeling. There are four basic equations in the model. The first two link output and the wage to population. the third links the wage to the extent of the city and the last  provides the population of the city

Equation one, following Bettencourt (p65) says that  urban productivity is proportional to population via a scale factor:\footnote{ In contemporary US cities productivity increases by about 11\% with each doubling of their population.  Urban Scaling and the Production Function for Cities Lobo J, Bettencourt LMA, Strumsky D, West GB (2013) PLOS ONE 8(3): e58407. https://doi.org/10.1371/journal.pone.0058407 }, 
\[Y= GN^{\beta}\]  

and has both theoretical and empirical support. 


\cite{arvidssonUrbanScalingLaws2023} find that citiesâ€™ tails are responsible for 36â€“80\% of the observed superlinearities across indicators. 

% \begin{tabular}{ll}
% $Y$ is &Aggregate urban output, or GDP \\
% %$\alpha$ & agricultural wage\\
% $G$ is&a `prefactor', possibly time dependent, an initial population\\
%  $N$ is& city population\\
% $ \beta$  is& scale factor, the elasticity of output with respect to city population .\\
% \end{tabular}\vspace{.5cm}

This is illustrated in Figure~\ref{fig-scale-output} for $\beta=1.25$ and $G=1$. The significant features are the upward-bending total output curve that indicates increasing productivity per capita for the city and the rising marginal product of labour.

\begin{figure}[htb]
    \begin{center}
    \begin{tikzpicture}
      \draw (0,4)node[above]{$Y= GN^{\beta}$}--(0,0) --(6,0)node[below]{Population};
       \draw[scale=1, domain=0:6, smooth, variable=\x, blue] plot ({\x}, {(\x/2)^1.25})node[below]{total output };% divide by 2 to get it on the plot
       %\draw (0,1)node[left]{$\alpha$}--(6,3.5)node[left]{$\alpha +\rho P$};
      \draw[scale=1, samples=200,domain=0:6, smooth, variable=\x, red] plot ({\x}, {(\x/2)^.25})node[below]{average output};% THis is the wage plot
    \draw[scale=1, samples=200,domain=0:6, smooth, variable=\x, green] plot ({\x}, {(1.25*(\x/2)^.25)})node[above]{wage= marginal product};
%[red] plot[samples=200, domain=-0:6] function {(\x/2)^.25}node[above]{wage};
      %  \node [left] at (0,2){$w=\rho P$};
         % \draw [dashed](0,3)node[left]{$Y_i$}--(6,3);
    \end{tikzpicture}\vspace{.5cm}
    \caption{Urban productivity is proportional to population, $\beta=1.13$}
    \label{fig-scale-output}
    \end{center}
\end{figure}

The right hand side of second equation is derived from the first bvy differentiation and combined with a result from the theory of the firm that says that the firm should hire until the marginal value product of labour is equal to the total wage, $\omega+w$, where $w$ is the `subsistance wage' that is earned by non-urban workers.  
\[\omega+w = \beta GN^{\beta-1}\]

The third is the population equilibrium condition, that requires that at the boundary of the city, $d^*$,  transportation costs, $td^*$, consume the entire wage:
 \[d^*=\frac{\omega}{t}\]

 The fourth is the function that generates the total urban poulation. In the standard circular city, for example, with a uniform density, $\delta$,  
 \[N=\delta\pi (d^*)^2\]
 % \[N=\delta\pi (\frac{\omega}{t})^2\]
 %\[N=\delta\pi (\frac{\beta GN^{\beta-1}-w}{t})^2\]
 
 The equilibrium population  is: 
% \[N=\delta\pi (\frac{\beta GN^{\beta-1}-w}{t})^2\]

\begin{eqnarray}
    N&=&\delta\pi (\frac{\beta GN^{\beta-1}-w}{t})^2\\
    &=&\frac{\delta\pi }{t^2} \left[\beta GN^{2\beta-2} -w^2\right]
\end{eqnarray}

This expression can be treated as a difference equation if we consider the left hand side as $M_{c}$ and the right hand side  function of the previous period's as population, $N_{{c}-1}$.



\subsection{Incorporating agglomeration economies in production} \label{sec-agglomeration-production}
%Production economies generated by agglomeration enter the production functions of the firms and, indirectly,  the aggregate production function of the city. 
A simple way  to introduce an agglomeration effect on the production side that is consistent with the existing literature is  to use a \gls{Solow-Swan model} with labour augmenting technical change (\cite{solowContributionTheoryEconomic1956, swanEconomicGrowthCapital1956}), $Y(t)=K(t)^{\alpha }(A(t)n)^{\beta }$ where $t$ denotes time,  %$0<\alpha<1$ is the elasticity of output with respect to capital, $\beta$ the elasticity of output with respect to effective labour,
 and $Y (t )$  represents total production. 
We %remove time  $t$ except in the technical change term, where we replace it with the population value $n$. To avoid confusion with the consumption amenity, we
 replace $A(t)$ %in the Solow-Swan models
  with $A(n)$, representing a labour-augmenting agglomeration effect.\footnote{The Mankiwâ€“Romerâ€“Weil version of the model adds a term for human capital.  It is not clear it would make a qualitative difference for our analysis.}  This differs from  the Slow-Swan, model in which labour augmenting technical change increases according to an exogenous (exponential) law.\footnote{An attractive ways to specify $A(n)$  is to use a simple exponential, $A(n)=n^\phi$, which changes Equation~\ref{eqn-solow-swan2} 
  We %The model  can produce increasing returns in the aggregate, which can drive city growth.
\begin{eqnarray}
 Y&=K^{\alpha }(n^{\phi }n)^{\beta}  \nonumber\\
 Y&=K^{\alpha }n^{\beta(1 +\phi)}
\label{eqn-solow-swan1}
\end{eqnarray}
This makes it clear that we can have increasing returns to scale for the urban economy if  $\alpha + \beta(1+ \phi)>1$ even with a production function at the firm level that is decreasing returns to scale ($\alpha +\beta<1$)).\label{footnote-psi}}  
%Rising transportation costs may become the limit on firm or city expansion.  
  
  $A(n)n$ is  ``effective labour'' and 
%\footnote{The Mankiwâ€“Romerâ€“Weil version of model adds a term for human capital.  It is not clear it would make a qualitative difference for our analysis.}  $T$ refers to effect of \textbf{labour-augmenting agglomeration}. The model then says that the 
firm output is 
\begin{equation} 
Y=K_i^{\alpha }(A(n)n_i)^{\beta }
\label{eqn-solow-swan2}
\end{equation}
% If $\beta=1-\alpha$, this is a constant returns to scale (CRS) production function. Without agglomeration effects, $T(n)=1$,  Then 
% \textbf{$\mathbf{L(n) = T(n) n}$ 
An individual firm will purchase labour time  and sell the product of effective labour. 
?If labour markets are competitive, it will set $\die{Y}{L}=w$.
We can assume  that $A(1)=1$ and $\frac{\partial A}{\partial n}>0$. 

Notice that this model ascribes all agglomeration effects to labour rather than capital Deepening  and widening of the labour pool was one of Marshall's explanations of the formation of industrial districts. The model can therefor  be seen as incorporating a Jacobs/Marshall externality (\cite{beaudryWhoRightMarshall2009, vanderpanneAgglomerationExternalitiesMarshall2004}) of the sort often invoked as an explanation of industrial clusters. These externalities  are not a product of any firm or individual. 









\subsection{Labour demand}\label{sec-labour-demand}
%This equation shows labour supply increasing with the square of the wage.  
%The  inverse labour supply function  is
%	\begin{equation}
%	w= (\frac{ {c}^2s}{\pi})^{0.5} L^{0.5},	%\label{eqn-inverse-labour-supply}
%	\end{equation}
%which is clearly increasing with the square root of the wage. 
%It's easier to show the wage curve is declining at a faster rate withthis equation. 

%K The marginal product of labour is declining. While adding more labour may always adds some value, the rate drops off.  If the marginal product increased, then a firm that got large enough would out compete smaller firms, hire all labour, always be able to produce more wealth by hiring more people, and would always produce more wealth by hiring people than by firing people. This doesn't happen.

%K Perhaps, the firm hires employees who best fit its needs first, but to grow, eventually it must hire less selectively. Finding markets may get harder with growth. Perhaps expansion adds additional costs, building a parking lot, administration, acquiring    a larger building. Whatever the explanation, the marginal product of labour declines. 

Profit maximizing firms  set the marginal value product of labour, $p\frac{\partial Y_i}{\partial n_i}$, equal to the wage. The marginal product of labour, however,  is complicated by the presence of the  agglomeration effect, $A(\sum n_j)$:
\begin{eqnarray} \frac{\partial Y_i}{\partial n_i} &=   K_i^\alpha \left(  \beta A n_i^{\beta-1}  + n_i^{\beta}A'  \right)  \nonumber\\
&=   \beta\frac{1}{n_i} Y_i   +  Y_i \frac{A'}{A}  \nonumber\\
&=   Y_i  \left[  \beta\frac{1}{n_i}  + \frac{A' }{A} \right]   \label{eqn-mpl}
\end{eqnarray}
The first term in the square bracket in Equation~\ref{eqn-mpl} might be termed the \textbf{private myopic marginal product}. It is the addition to output directly attributable to an additional worker. This myopic MPL is smaller than the actual marginal product for the firm.  
The second term in the bracket   is the marginal agglomeration effect. It captures the effect on firm-wide labour productivity -- an increase in effective labour --   that results from adding a worker. We can expect this to be very small.\footnote{Using the specification in Footnote~\ref{footnote-psi}, $Lambda(n)=n^\psi$, it would be $\frac{\psi}{n}$. If f $\psi=0.1$ and $n=250,000$ the number is $\frac{A' }{A} =4\times 10^{-7}$.}% REVIEW THIS 
% REVIEW THIS TOO
%\footnote{Firm size matters. 
%A monopoly employer would take into account the marginal agglomeration effect. 
%A firm that employed a large enough fraction of the urban workforce to notice agglomeration effects, say $\frac{1}{n}<k<1$, would enjoy that fraction of the external effect and set the wage at  
%\[w_k =  \beta\left( \frac{1}{n}+ \frac{kA'}{A(n)} \right)	Y\].} 


It seems likely that the agglomeration effect of adding a worker on the productivity of other workers in that firm, $Y_i \frac{A'}{A}$, would be difficult to attribute to a new worker. It would be a lagged, unevenly distributed effect, and would appear exogenous, and so would not be compensated. We assume therefore that firms do not take the second term into account. %If we also assume that firms take the wage as parametric, firms hire until the private myopic marginal product falls to the observed wage, 
%		\[  \beta\frac{1}{n_i} Y_i =    w+\phi , \]
implying firms will hire fewer than the optimal number of workers.
\begin{table}[htbp]
\caption[Four views of the of the marginal agglomeration effect]{Four views of the of the marginal agglomeration effect, $\frac{A'}{A}$}
\begin{center}
\begin{tabular}{rlcccc}\small
    & 	\hspace{2cm}$\frac{A'}{A}=$	& $.01$ & $.01$ & $.001$  &  $4\times 10^{-7}$\\ \cline{3-4}
\   &  	version  		& 1 firm 		&10 firms		&100 firms 	& 1000 firms		\\ \hline%\cline{3-5}
 1 &myopic 		&0 			& 0			& 0       		&	0				\\
 2 &firm wide, 0CV 	& $0.01Y$		& $0.01Y_i$	& $0.001Y_i$	& $4\times 10^{-7}Y_i$	\\
 3 &firm wide, 1CV	& $0.01Y$		& $0.1Y_i	$	& $0.1Y_i$	&$4\times 10^{-4}Y_i$	\\
4  &social 			& $0.01Y$ 	&  $0.1Y$		& $10Y_i$		&$4\times 10^{-4}Y_i$	\\
 \hline
\end{tabular}
\end{center}
\label{table-marginal-agglomeration}
\end{table}%


Even taking into account firm-wide labour productivity gains, the private marginal product of labour is likely to be computed on the assumption that other firms do not expand  their workforce. This could be call the `zero conjectural variation' (0CV) case. If all firms  were expected to respond to the same signal the same way (1CV), the agglomeration effect  would be multiplied by the number of firms, $\frac{n }{n_i}$. The marginal agglomeration effect for firm $i$ is then $\frac{n }{n_i}\frac{A' }{A}Y_i =\frac{A' }{A}Y$. 

Since the increase in $A$ affects all firms, the  social marginal product of all firms expanding their workforce by one worker as $i$ does must be multiplied again by the number of firms. The  value of the agglomeration effect increases with the number of firms. 

\begin{figure}[tb]
\begin{center}
\input{fig/growth-amenity.tex}
\caption{Multiple marginal products}
\label{fig-growth-amenity.tex}
\end{center}
\end{figure}

 illustrates the labour supply curve and the four versions of MPL that arise for any standard production function with diminishing marginal product of labour and agglomeration effects of the sort we model. These agglomeration effects account for O'Sullivans axioms (b), (c) and (d) for this and similar models. 

 
\subsubsection{Output and wage}
We need a combination of classical and neoclassical distribution theory.

City output is divided among the classes of society. Neoclassical theory suggests wages are allocated according to marginal product and classical theory suggests rents according to the pattern of ownership.

Equation one, in effect determines a wage, (Given the observed values for the scaling coefficients for total wages and labour, $bW < 1.15$ and $bL < 1$, )  although there are many possible distributional specifications and many possible labour market and firm structures. Bettencourt provides two  estimates,  1.11 and 1.35, for the scale factor for urban personal income in the Brazil and South Africa respectively. A more recent  study supports the Bettancourt results for China.\footnote{Wu W, Zhao H, Tan Q, Gao P. An Urban Scaling Estimation Method in a Heterogeneity Variance Perspective. Entropy (Basel). 2019 Mar 28;21(4):337. doi: 10.3390/e21040337. PMID: 33267051; PMCID: PMC7514821.} 

\subsubsection{Wage and city size}
The third determines the extent of the city. This comes form the Alonzo model discussed in chapter XXXXA. 

% PROBABLY REMOVE - FIGURE REPEATS
\begin{figure}
    \begin{center}
    \input{fig/rent_ricardo.tex}
    \caption{Transport costs, the yellow area, take a share of the profit for vegetables sold in the town}
    % \label{fig-rent-ricardo}
    \end{center}
\end{figure}

\begin{figure}
    \begin{center}
    \input{fig/rent_alonzo.tex}
    \caption{A circular city with uniform transportation costs.}
    \label{fig-rent-alonzo}
    \end{center}
\end{figure}

A simple case is the circular city with uniform transportation cost, $t$. \[r^*= \frac{w}{t}\]% A more complex model might have density depend on location, for example, in the continous circular cityt\,
If transportation costs vary by  distance we might have something like this constraint on extent\[w=\int_0^{d*} t(d)dt.\]

This approach imposes an equilibrium condition on the model. It is unnecessary working with a citation of known extent and density. The analytic approach is easily extended to variable transportation cost, although at the expense of additional computational complexity.

\subsubsection{City extent and population}
Equation  four  closes the model by linking the extent of the city to the population. A simple case is the circular city with uniform population $d$, where $d$ is density per unit area and $r^*$ is the radius of the city: \[P=d\pi r^{*2}\] 
More generally, density might vary with for example, the distance $r$ from the centre of the city:
\[P=\pi \int_{0}^{r*}d(r)\,dr\] 
In a computational model a table of densities would provide the link.



\subsubsection{challenges}
maybe discuss some of the modeling challenges - division of income, lags, ???

\vspace{2cm}


\subsection{Cities becoming productive}
 The growth of many cities was initially fueled by agricultural rents and resource exports. The industrial revolutions transformed many of these consumption cities into thriving production centers. 

while the ``origins'' of consumption cities can be traced to (i)
resource rents, (ii) rents from agricultural exports in countries with sufficiently high agricultural productivity, and (iii) ``premature'' deindustrialization.  Source:
%\href{https://www.brookings.edu/blog/future-development/2022/07/14/1622441/}
{Are cities engines of production or consumption, and does it matter?}


