\chapter{Removed from model}
\section{IMPLEMENTATION: Relating the market model to the code}
The chapter links the theory to the output of the simulations. %is intended to explain the code and justify the modeling decisions that link the theory to the actual 


\section{MOVE UP? Bargaining - The market process and bargaining}
We consider a homogeneous city with a single wage, identical preferences, uniform identical transportation costs, identical lot sizes.

Individuals and institutions buy and sell properties given individual goals, resources and available information.

% The process can be summarized as
The model of the market process includes the following steps:
The core machinery of the model is the market process. At the centre of that process is a model of price formation and bargaining. % bargaining model. 

\begin{enumerate}
    \item Identify the set of sellers for the current cycle. This may include:
    \begin{enumerate}
        \item people retiring in this cycle,
        \item people who retired and failed to sell, and potentially
        \item people approaching retirement who might consider selling early and
        \item financialized owners. % the bank? speculative owners? .
    \end{enumerate}
    
    \item For each seller, calculate the expected property price: % \textbf{from real estate agent}:
    \begin{enumerate}
        \item Initialize with the warranted price, which is the value of the stream of services, provided by the property. Rents minus net costs:
       \[ P_W=\frac{(\omega-{dc}) + {a}\psi}{r}\]
        The value of the house is the rent premium minus the cost of transportation. Subtract the costs of running the house, divided by the interest rate
    
        IS IT MINUS A $\psi$ SINCE HIGHER COSTS LOWER PRICES?
       
        {\color{green} This is the expected warranted price. It might make sense just to use the homeowner's reservation price (maximum bid price)}.
        \item in later cycles use the actual transaction price $P_M$ (with inflation added) when it is available, or use a (regression)estimate $P_{it}^e$ the real estate agent.
    \end{enumerate}
    
    \item for each seller, compute a reservation price using a variant of the maximum bid price formula. 
    {\color{green}\textit{Values like $m_i$ are going to be expected values for others.  ??? }}
    \textit{This is what the seller thinks she should get, taking into account her expectations about the price increase etc..}
    
    \item for each seller, compute an asking price. 
    \textit{Add some percentage to the reservation price. Make sure the result is above ***? $P_M^e$, since you know you might have to come down in bargaining.}   
    
    \item for each seller, list the asking price for bidders to see.
    
    \item for each property, identify a set of potential bidders.
    \begin{enumerate}
        \item Bank considers bidding on all listed properties.
        the formula is the maximum bid price with its own parameters putting in the current rents.
        \item New entrants to labour market
       {\color{yellow} \item Retirees who might sell, move out of town and invest in a rental property}
    \end{enumerate}
    
    \item for each bidder, compute a maximum price using a variant of the bid price formula. 
    
    \item for each bidder, compute an initial bid no higher than  the maximum price. 
    \color{red}  
    \textbf{(there may be two paths to consider: working from initial bids, or working with max bids )}
    
    \item With list of max bids, check to see if any exceed the asking price. 
    \begin{enumerate}
        \item If yes settle on asking price if there is just one, and the second highest max bid if there are more than one.
        \item If no, proceed.
    \end{enumerate}
    
    \item With list of max bids, check to see if any exceed the reservation price. 
    \begin{enumerate}
        \item If no, house is not sold, and reservation price is reduced for the next cycle.
        \item if one max exceeds the reservation price,  split the difference between the reservation price and the maximum bid bid.
        \item if more than one max exceeds the reservation price, choose the second highest max bid if there are more than one
    \end{enumerate} 
\end{enumerate} \color{black}


-----

All agents have access to the price forecast, $P_M^e$, from the real estate agent.

We have five categories of potential buyers.\footnote{Types three and four  would  become landlords if the transaction is completed, which is a change of class status.} 
\begin{enumerate}
    \item newcomers to the city, who have a job offer  and seek to buy a home or become tenants.  
    \item financial investors who possess financial capital and seek a rate of return better than they would receive from alternative investments. We refer to this investor as `the bank'
    \item owner-occupiers who might mortgage their current homes  to purchase a revenue property
    \item owner-workers who retire and might  invest in a revenue property rather than spending  their capital gain 
    \item sellers are also default buyers, since they can buy their own home and rent it out if their \gls{reservation price} is not met.  
\end{enumerate}


For potential sellers the maximum bid price is also the `\gls{reservation price}' price.  
\[P^{ask}> P^r, \qquad   P^{offer}< P^{max}\]


All potential buyers and potential sellers  will calculate a \gls{maximum bid price} or reservation price and and an initial offer price or ask price \gls{bid  price}. 

The initial bid price (offer) will be lower than the potential buyers maximum bid price. The initial ask price will be higher than the reservation price.

Bargaining will occur when the maximum bid price of at least one agent exceeds the reservation price of the listing agent.

Transactions can occur when the maximum bid price of at least one agent exceeds the reservation price of the listing agent.


\subsection{Determining initial offer and ask prices}

Agents can calculate their maximum bid  or their  reservation price. 
These values are not public. We need to identify initial ask and offer prices, which is the way they appear in the market.


\[P^{ask}> P^r> P_M^e\] 

If the posted expected price exceeds their \gls{reservation price} they 
\begin{enumerate}
    \item list  the property for sale with the real estate age,nt.
    \item select an asking price   
\end{enumerate}

The bank posts a \gls{maximum bid function} with the real estate agent.

In practice, potential investors will make an  initial  bid that is lower than this value and subsequent bargaining will settle of a price between the initial bid and the seller's asking price.

In the market, the initial bid should be smaller than the bid price calculated, which is a maximum that can earn the target rate of return, The bank will definitely go this high. 

% If there is a  max bid among competing buyers, the second highest max bid should be the sale price, but the bidder with the highest max bid wins the property. This is realistic because in a bidding war the final bid only has to be a very small amount higher than that of the last competitor left.
% That is the highest price that a seller can get.

 %This  seems realistic enough and is very simple to implement. It should producer a path that is indistinguishable form any more complex approach. 

% Will persons retiring who would leave the city invest in an urban rental?



% But what is $D$? Does the bank have unlimited funds? Isn't D just a fraction of P?  If so it cancels out
% r is the prime rate- that the bank pays? 



% \begin{verbatim}
% \end{verbatim}

\section{Computing values for bid and warranted price}

In the following sections we discuss % the computation of agents' bid price, outline potential discounting approaches, and discussing 
how each component of the calculation is treated in the code. %, organizing the discussion following Equation~\ref{eqn-bid-price2}:


\begin{align}
P_i^{bid} \le   \frac{\mathcal{R}_N}{(1-m_i)r_i^{target}- \delta_i \left(1+L(P)- (1+ r_i)m_i\right)}.
\end{align}
Net rent, $\mathcal{R}_N$, is discussed in section \ref{SS:NetRent}. 

Interest rates, discount rates, and borrowing ratios are discussed in section \ref{SS:RatesAndRatios},
The borrowing ratio, $m_i$, is discussed in section \ref{SS:BorrowingRatio}, the target interest rate, $r_i^{target}$, is discussed in \ref{SS:targetr} the discount factor, $\delta_i$ is discussed in section \ref{SS:discountfactor}. The price approximation mechanism, $L(P)$ is discussed in \ref{SS:PriceForecast}, and the interest rate the buyer has to pay for the mortgage, $r_i$, is discussed in \ref{SS:BankRate}. Sections are thus numbered: 

\begin{align*}
P_i^{bid} \ge   \frac{\ref{SS:NetRent}} {(1-\ref{SS:BorrowingRatio})\ref{SS:targetr}-
\left[ \ref{SS:discountfactor}(1+\ref{SS:PriceForecast}- (1+\ref{SS:BankRate})\ref{SS:YWealthConstraint})\right]}. 
\end{align*}


\section{CODE DISCUSSION}
present value of tax on propriety over T years. 

\section{Operating cost calculations}
\begin{verbatim}
property value * tau * (sum_(1-T) ((1/(1+r))^t).    
    (sum_(1-T) ((delta_t)

psi   = 100000 # subsistence wage
    
#  Annual operating cost in dollars  
#  eg psi=100000 b=.02 , a*b*psi= 2000 per year 

 compounded for 5 years Must add the discount factors  
 \delta_t for five years 
 \[ oppcost=  \[\frac{\omega+a\phi}{r} \tau + a\phi b\right]\sum_1^T \frac{1}{1+r}\]
 a*b*psi/.r - (a*b*psi/r)*delta_T
#  eg   2000/.r - (2000/r)*delta_T 
= 2000/0.05 - (2000/0/05)*delta_T = 8658.953

opperating_cost = a*b*psi/r - (a*b*psi/r)*delta_T 
\end{verbatim}

\[ oppcost=  \left(\tau\omega  +(\tau+b)a\psi\right)\sum_1^T \left(\frac{1}{1+r}\right)^t\]

\begin{verbatim}
    opperating_cost = (tau*(omega-c*d) + (tau+b) *a*psi)* sum((1/r)^t for t in range(1, T))
    
This is (tax on rent plus both tax and maintenance on the house and land) for (T years with discounting for each year),
\end{verbatim}



----


The relationship between income and consumption is suppressed, because that makes xyz.. so much clearer.

because it ignores
but the relationship

but the relation ship between x and y is not..

don't care what they do in retirement, so ignoring it, so they're still capturing capital gains so long as they own a house
t
their lifetime income is changing even though their current income is not.

--
renters get none of that.



$delta_T$ 
$sum_delta_T$
% $sum_r_T$

$r_T$  present value of total interest payments made over period T




${a}$  =  share of subsistence wage  used for land and building e.g. 0.3

${b}$  = share of share of subsistence wage  used on maintenance e.g. 0.2

${c}$  = annual tax rate on rent and home  e.g. 12 mills 


a     share of subsistence wage  used for land and building

b      share of share of subsistence wage used for maintaining home

c    annual tax rate on rent and home  eg  1.6\% = 16 mills, 1.2\% =.12 mills

% Sigma is tax share, what is the tax rate.
% delta is density ** - - infinitesmal density increase as the city moves out. [[adjustment speed for wage N]] imagine a density function over the city. 

\section{SORT Housing services 30 percent}
MOVE TO ASSUMPTIONS - We assume households spend a fixed fraction $a$ of their subsistence wage $\psi$ on housing. 

\footnote{***JUSTIFY ASSUMPTION OF FIXED SHARE OF SUBSISTENCE HERE? This appears to be empirically justified and simplifies the model \cite{GET_SOURCE_HOUSING_A_FIXED_SHARE_SUBSISTENCE_WAGE}. Appendix \ref{appendix-future-work} considers how the assumption may be relaxed in future work.}

Housing services absorb about 30\% of income  we will use than number  as an approximation,  $a\psi$, where $a$ is the share of the subsistence wage and $\psi$

Note, this is a simplification. It ignores any locational values of the house, as well as the costs stream, it is a net cost, but a net cost embedded in the share of the income. It is a justified simplification, but an interesting place to explore the effect of adding nuance.  MAYBE MOVE DISCUSSION OF POTENTIAL EXTENSIONS TO FUTURE WORK.

\section{Net rent}\label{SS:NetRent}
We assume that the present value of the rent % $\mathcal{R}$ 
is known to an investor in advance. We can imagine the investors' accountant having information on the rent that the market will bear or on prior rents and including this information in the calculation of $P_B$.

Uncertainty can be represented as bias or stochasticity.
Calculation notes: I have rent from the wages. I have kappa and sigma from our ex parameter values. . omega from the wages. 

Net rent, which can be written a share, $\phi$ of total rent $\mathcal{R}_N = \phi \mathcal{R}$
$\mathcal{R}_N = \phi \mathcal{R}$

Where the \gls{rent share}, phi is a fraction
$\phi = (rent-taxes-costs) /rent$ 

There's a distinction between the warranted rent, the net rent, and the rent that's actually charged.

We assume that the  rent  actually charged to a tenant is the warranted economic rent, ($\mathcal{R}= \omega - {dc}$), but the relevant term to enter into the calculation of return on investment is the net rent $\mathcal{R}_N$ for a given property, because the returns are the returns an investor can get after paying taxes and operating costs.

In our computational model, we do the calculation in terms of a mortgage, so we want the total returns after expenses, in present value, compounded over the mortgage  period.
% We want the total returns after expenses, in present value, compounded over a 5 year period.

\begin{align}
\mathcal{R}_N &= \mathcal{R} - \mathcal{O} - \mathcal{T} 
\end{align}

In terms of the warranted rent, 
\begin{align}
\mathcal{R}_N &= (1-\kappa_j - \sigma_j)(\omega - {dc}) % was {d_j} here
\end{align}


% $\mathcal{R}_N = (1-\kappa_j - \sigma_j) (\omega - {c} d_j)$

% {\color{red}
% Notice that  we need here is really the fraction of the warranted rent that the owner gets to keep after maintenance costs and taxes. It is possible that the owner is charging more or less than the economic  rent, but economic rent can be seen as an equilibrium value. Economic rent is $\mathcal{R}$.  This is (tautologically) related to the price as a fraction of the actual sale price: COULD MOVE TO THE CHAPTER NOW SINCE THE THE SECTION IS MOVED THER
% }
% \[\mathcal{R}= \frac{\mathcal{R}}{P_0}P_0 \]

If we want to know the  present value  of the \textbf{net rent}, $\mathcal{R}_N$  collect over the period  $T$, $\mathcal{R}_N^T$, we \textbf{add up} the discounted rents for each year. We may assume the rents are rising at and that the first is the current warranted rent, which gives us a computational formula. 
\[\mathcal{R}_N^T= (\omega-dc)\sum_{t=0}^{t=T-1} \frac{(1+\dot{\mathcal{R}})^{t}} {(1+r_{r_\delta})^{t+1}} \]

% \[\mathcal{R}_Nj^T= (\omega-dc_j)\sum_{\tau=0}^{\tau=T-1}\left[\frac{1+\dot{\mathcal{R}}}{1+r_{r_\delta}}\right]^\tau \]
\noindent where $\dot{\mathcal{R}}$ is an expected rate of change of rents - possibly zero for now, and $r_\delta$ is the individual's discount rate. 

TODO: problem - how to handle subscripts with net rent $\mathcal{R}_N$


\subsection{Tax ratio}\label{SS:TaxRatio} 
The tax ratio $\sigma$ is the share of rents that the municipality takes for services and infrastructure. This fraction of the value of the property is about 30\% based on mill rates in Ontario,  so $\sigma = 0.3$. % REFERENCE

*** CHECK Total taxes paid on  property $j$, over a given mortgage period $T$ is 

\[\Psi_j^T = \psi * \mathcal{R}\].  

    %\href{https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwiOmNPUvIL9AhUUmokEHX-5C9oQFnoECBIQAQ&url=https%3A%2F%2Fwww.greatersudbury.ca%2Fcity-hall%2Ftax-services%2Fpdf-documents%2F2022-tax-rates%2F&usg=AOvVaw2XEdfcC5z-5AqfOeH5t-eN}{Sudbury values}  same as https://www.greatersudbury.ca/city-hall/tax-services/pdf-documents/2022-tax-rates/

\subsection{Cost tax ratio}\label{SS:CostRatio} 
The value of $\kappa$  varies for every property based on maintenance requirements, historic rents, tenant rights, and variations in assessed values. If it varies, it may be useful as a quality indicator.

%Values for $\kappa$ and $\sigma$ must be adjusted to take into account the length of the period or net rents have to be summed over the period.  NO LONGER NEEDED 

Nothing prevents $\sigma+\kappa >1$, which would leave an investor unable to cover building maintenance and taxes out of current rent. 


% image.png

% image.png
% https://www150.statcan.gc.ca/n1/pub/46-28-0001/2023001/article/00001-eng.htm

% Investors now make up more than 25\% of Ontario homebuyers, pushing prices higher, experts warn. 2020

% Released: 2022-04-12

% New data from the Canadian Housing Statistics Program (CHSP) show the extent of inequalities in housing: multiple-property owners possess nearly one-third of all residential properties and the top 10\% wealthiest owners account for around one-quarter of residential housing value. Despite these inequalities, new data show an increase in the number of first-time home buyers from 2018 to 2019.
% Both income and housing wealth are concentrated at the top, even among owners. When ordering individual owners by their yearly incomes, the top 10% of owners in Ontario and British Columbia each had yearly incomes above $125,000.
 

\subsection{Borrowing ratio} \label{SS:BorrowingRatio}


The borrowing ratio, $m_i$, is just the fraction of the price that the bank will lend to a potential buyer. \textbf{It may depend on the individual.} 

Income(\ref{SS:YWealthConstraint}) and/or wealth (\ref {SS:MWealthConstraint}) may constrain individual participation in markets. 
Here we should use the same logic as we use about the interest rate charged. (\ref{SS:BorowingRate})

It is likely to be higher for institutional buyers  and for the wealthy because the bank thinks those with assets are more secure risks. they may have other assets that could be attached in the case of default.
(note interventions with reduces interest rates, or loan assessments drawing on techniques used by foundations could have value)


\subsection{Target interest rate}\label{SS:targetr}

 The target interest rate, $r^{target}$, is the prime rate plus a margin. % required by the bank.  Question: do non-bank actors have such a term?

\begin{verbatim}
self.get-target-interest-rate(buyer)
\end{verbatim}



\subsection{Discount factor}\label{SS:discountfactor}

The discount factor $\delta_i$ for THE END OF period $T$ captures the cost of waiting $T$ periods to sell the property. The usual way to treat it, which we use here, is to assume that $i$ has an interest rate $r_i$ and has been investing efficiently. This means that  the individual has a discount factor for future returns based on the year-over-year rate of return. 

\[\delta^T_i=\left[\frac{1}{1+r_i}\right]^T\]




If we want the compounded interest rate person $i$ the term T,
\[r_i^T=(1+r_i)^T\]
% This is the value we use in equation~\ref{EqBidPrice}.

If person $i$  discounts at a discount rate $r^\delta$, the present value of a receipt at time $t$ is calculated by using the \textbf{discount factor} $\delta_i^T$.

\[\delta_i^T= \left( \frac{1}{1+r_\delta} \right)^T \]
%\[\delta_i^T= \sum_{\tau=0}^{\tau=T}\left( \frac{1}{1+r_\delta} \right)^\tau \]
 
These can be combined into a function %\delta that  gives a single discounting factor  for a value  like future price that is both growing and being discounted over several (T) periods:
\[ PDV(P_M^{Te})=P_0\left( \frac{1+\dot P}{1+r_\delta} \right)^T \]
This PDV function specifically combines any expected rent increase, the individual's discount rate and the mortgage term into a single operation.

% \subsection{Mortgage availability}
% For home loans, many personal finance experts recommend total housing costs account for less than 28\% of your \textbf{gross} household income, This gives us an \textbf{income-based  mortgage maximum} of \[M^{max}_Yi = \frac{0.28*(\omega+w)}{r_i}\] It is the maximum the bank will let you pay.

% We assume $r_i$ is based on the individual's assets, on relative wealth. Where is it calculated for the householder or the bank?

% We get a \textbf{price-based mortgage maximum} \[M^{max}_P = 0.8P_0\] where $P_0$ is the actual sale price. This is based on the maximum amount of risk that the bank is willing to take on. ($P_0$  will not always be the same as the asking price or the warranted price.)

\subsection{SORT Cobb-Douglas constant fraction of income on housing}
It is convenient in this model to use a \gls{Cobb-Douglas} utility function that has the property that a fixed fraction of income is spent on housing.  We can start with the assumption that earnings are fixed for the lifetime at the one-period wage, $w$. Then total spending on housing is $\beta Y, \beta <1$ and $ Y=w$. Let the transportation cost for a specific location $l$ be $T(l)$. The  equilibrium price at that location will be $P(l)= \beta Y-T(l)$.

\section{SORT: Miscellaneous calculations about rates over time}
$delta(0)=1$  for funds received now

Lets calculate $S$, $\delta$ at time infinity:
*** Why?

\[\delta(t)=\left(\frac{1}{1+r}\right)^t\]

\begin{align}
delta (1)   &= 1/(1+r) \\
delta (t)   &= (1/(1+r))^t \\
delta (\infty)   &= \sum_0^\infty\left(1/(1+r)\right)^t\\ 
Let\ a=1/(1+r)&<1\\
delta (\infty)   &= \sum_0^\infty a^t\\ 
S               &= \sum_0^\infty a^t\\ 
               &= 1+a+a^2+a^3+a^4 \dots\\ 
S-aS             &= 1\\ 
S             &= 1/(1-a)\\ 
S             &= \frac{1}{1-\frac{1}{1+r}}\\ % subing r back in for a 
             &= \frac{1}{1-\frac{1}{1+r}}\\ 
             &= \frac{1}{\frac{1+r-1}{1+r}}\\ 
              &= \frac{1}{\frac{r}{1+r}}\\ 
             &= \frac{1+r}{r}
\end{align}
This is the case where you get paid at the beginning of the first period. Rent might be paid in advance for each month. .

For  the case where you get pay at the end of the first period. Interest on a loan  might be paid this way.  summing from t=1 this time, we get $S-aS =a$, and $S = a/(1-a)= \frac{1}{r}$. 

 

%\[\delta(t)= \delta(1)^t =\left(\frac{1}{1+r}\right)^t\]

Finally, we need an expression for the sum of a finite  series to T.  Doing the derivation to check my logic, notice that  omega, psi, c  and a are constants that can be factored out in the following,(\textbf{THIS IS THE WRONG PROPERTY VALUE}
%\[\left(c*\omega + c*a*\psi \right) ->c\left(\omega-trans\ d + a\psi \right)\]
\begin{align}%
    tax&= \sum_{t=0}^{T-1} \delta(t) \left(c*\omega + c*a*\psi \right)\\
        &= c(\omega + a\psi)\sum_{t=0}^T  \delta_t\\
        &= c(\omega + a\psi)(\delta_1+\delta_2 \dots \delta_T)\\
        &= c(\omega + a\psi) \left(\sum_0^\infty \delta_t-\sum_{T}^\infty \delta_t\right)\\
        &= c(\omega + a\psi) \left(\frac{1+r}{r}  - \left(\frac{1}{1+r}\right)^{T+1} \left(\frac{1+r}{r} \right) \right)\\
        &= c(\omega + a\psi) \frac{1+r}{r}\left(1  - \left(\frac{1}{1+r}\right)^{T+1} \right)
%      &=& c(\omega + a\psi)\delta_T\\
\end{align}

\chapter{MODEL PARTS CUT FROM BACKGROUND CHAPTERS}

\section{GROWTH}

\section{Equilibrium city size and the scale factor} 
At this point, we can briefly describe how the discussion of this chapter relates to our overall modeling. There are four basic equations in the model. The first two link output and the wage to population. the third links the wage to the extent of the city and the last  provides the population of the city

Equation one, following Bettencourt (p65) says that  urban productivity is proportional to population via a scale factor:\footnote{ In contemporary US cities productivity increases by about 11\% with each doubling of their population.  Urban Scaling and the Production Function for Cities Lobo J, Bettencourt LMA, Strumsky D, West GB (2013) PLOS ONE 8(3): e58407. https://doi.org/10.1371/journal.pone.0058407 }, 
\[Y= GN^{\beta}\]  

and has both theoretical and empirical support. 


\cite{arvidssonUrbanScalingLaws2023} find that cities' tails are responsible for 36--80\% of the observed superlinearities across indicators. 

% \begin{tabular}{ll}
% $Y$ is &Aggregate urban output, or GDP \\
% %$\alpha$ & agricultural wage\\
% $G$ is&a `prefactor,' possibly time dependent, an initial population\\
%  $N$ is& city population\\
% $ \beta$  is& scale factor, the elasticity of output with respect to city population .\\
% \end{tabular}\vspace{.5cm}

This is illustrated in Figure~\ref{fig-scale-output} for $\beta=1.25$ and $G=1$. The significant features are the upward-bending total output curve that indicates increasing productivity per capita for the city and the rising marginal product of labour.

\begin{figure}[htb]
    \begin{center}
    \begin{tikzpicture}
      \draw (0,4)node[above]{$Y= GN^{\beta}$}--(0,0) --(6,0)node[below]{Population};
       \draw[scale=1, domain=0:6, smooth, variable=\x, blue] plot ({\x}, {(\x/2)^1.25})node[below]{total output };% divide by 2 to get it on the plot
       %\draw (0,1)node[left]{$\alpha$}--(6,3.5)node[left]{$\alpha +\rho P$};
      \draw[scale=1, samples=200,domain=0:6, smooth, variable=\x, red] plot ({\x}, {(\x/2)^.25})node[below]{average output};% THis is the wage plot
    \draw[scale=1, samples=200,domain=0:6, smooth, variable=\x, green] plot ({\x}, {(1.25*(\x/2)^.25)})node[above]{wage= marginal product};
%[red] plot[samples=200, domain=-0:6] function {(\x/2)^.25}node[above]{wage};
      %  \node [left] at (0,2){$w=\rho P$};
         % \draw [dashed](0,3)node[left]{$Y_i$}--(6,3);
    \end{tikzpicture}\vspace{.5cm}
    \caption{Urban productivity is proportional to population, $\beta=1.13$}
    \label{fig-scale-output}
    \end{center}
\end{figure}

The right hand side of second equation is derived from the first bvy differentiation and combined with a result from the theory of the firm that says that the firm should hire until the marginal value product of labour is equal to the total wage, $\omega+w$, where $w$ is the `subsistance wage' that is earned by non-urban workers.  
\[\omega+w = \beta GN^{\beta-1}\]

The third is the population equilibrium condition, that requires that at the boundary of the city, $d^*$,  transportation costs, $td^*$, consume the entire wage:
 \[d^*=\frac{\omega}{t}\]

 The fourth is the function that generates the total urban poulation. In the standard circular city, for example, with a uniform density, $\delta$,  
 \[N=\delta\pi (d^*)^2\]
 % \[N=\delta\pi (\frac{\omega}{t})^2\]
 %\[N=\delta\pi (\frac{\beta GN^{\beta-1}-w}{t})^2\]
 
 The equilibrium population  is: 
% \[N=\delta\pi (\frac{\beta GN^{\beta-1}-w}{t})^2\]

\begin{eqnarray}
    N&=&\delta\pi (\frac{\beta GN^{\beta-1}-w}{t})^2\\
    &=&\frac{\delta\pi }{t^2} \left[\beta GN^{2\beta-2} -w^2\right]
\end{eqnarray}

This expression can be treated as a difference equation if we consider the left hand side as $M_{c}$ and the right hand side  function of the previous period's as population, $N_{{c}-1}$.



\subsection{Incorporating agglomeration economies in production} \label{section-agglomeration-production}
%Production economies generated by agglomeration enter the production functions of the firms and, indirectly,  the aggregate production function of the city. 
A simple way  to introduce an agglomeration effect on the production side that is consistent with the existing literature is  to use a \gls{Solow-Swan model} with labour augmenting technical change (\cite{solowContributionTheoryEconomic1956, swanEconomicGrowthCapital1956}), $Y(t)=K(t)^{\alpha }(A(t)n)^{\beta }$ where $t$ denotes time,  %$0<\alpha<1$ is the elasticity of output with respect to capital, $\beta$ the elasticity of output with respect to effective labour,
 and $Y (t )$  represents total production. 
We %remove time  $t$ except in the technical change term, where we replace it with the population value $n$. To avoid confusion with the consumption amenity, we
 replace $A(t)$ %in the Solow-Swan models
  with $A(n)$, representing a labour-augmenting agglomeration effect.\footnote{The Mankiw--Romer--Weil version of the model adds a term for human capital.  It is not clear it would make a qualitative difference for our analysis.}  This differs from  the Slow-Swan, model in which labour augmenting technical change increases according to an exogenous (exponential) law.\footnote{An attractive ways to specify $A(n)$  is to use a simple exponential, $A(n)=n^\phi$, which changes Equation~\ref{eqn-solow-swan2} 
  We %The model  can produce increasing returns in the aggregate, which can drive city growth.
\begin{eqnarray}
 Y&=K^{\alpha }(n^{\phi }n)^{\beta}  \nonumber\\
 Y&=K^{\alpha }n^{\beta(1 +\phi)}
\label{eqn-solow-swan1}
\end{eqnarray}
This makes it clear that we can have increasing returns to scale for the urban economy if  $\alpha + \beta(1+ \phi)>1$ even with a production function at the firm level that is decreasing returns to scale ($\alpha +\beta<1$)).\label{footnote-psi}}  
%Rising transportation costs may become the limit on firm or city expansion.  
  
  $A(n)n$ is  ``effective labour'' and 
%\footnote{The Mankiw-Romer-Weil version of model adds a term for human capital.  It is not clear it would make a qualitative difference for our analysis.}  $T$ refers to effect of \textbf{labour-augmenting agglomeration}. The model then says that the 
firm output is 
\begin{equation} 
Y=K_i^{\alpha }(A(n)n_i)^{\beta }
\label{eqn-solow-swan2}
\end{equation}
% If $\beta=1-\alpha$, this is a constant returns to scale (CRS) production function. Without agglomeration effects, $T(n)=1$,  Then 
% \textbf{$\mathbf{L(n) = T(n) n}$ 
An individual firm will purchase labour time  and sell the product of effective labour. 
?If labour markets are competitive, it will set $\die{Y}{L}=w$.
We can assume  that $A(1)=1$ and $\frac{\partial A}{\partial n}>0$. 

Notice that this model ascribes all agglomeration effects to labour rather than capital. Deepening  and widening of the labour pool was one of Marshall's explanations of the formation of industrial districts. The model can therefor  be seen as incorporating a Jacobs/Marshall externality (\cite{beaudryWhoRightMarshall2009, vanderpanneAgglomerationExternalitiesMarshall2004}) of the sort often invoked as an explanation of industrial clusters. These externalities  are not a product of any firm or individual. 









\subsection{Labour demand} \label{section-labour-demand}
%This equation shows labour supply increasing with the square of the wage.  
%The  inverse labour supply function  is
%	\begin{equation}
%	w= (\frac{ {c}^2s}{\pi})^{0.5} L^{0.5},	%\label{eqn-inverse-labour-supply}
%	\end{equation}
%which is clearly increasing with the square root of the wage. 
%It's easier to show the wage curve is declining at a faster rate withthis equation. 

%K The marginal product of labour is declining. While adding more labour may always adds some value, the rate drops off.  If the marginal product increased, then a firm that got large enough would out compete smaller firms, hire all labour, always be able to produce more wealth by hiring more people, and would always produce more wealth by hiring people than by firing people. This doesn't happen.

%K Perhaps, the firm hires employees who best fit its needs first, but to grow, eventually it must hire less selectively. Finding markets may get harder with growth. Perhaps expansion adds additional costs, building a parking lot, administration, acquiring    a larger building. Whatever the explanation, the marginal product of labour declines. 

Profit maximizing firms  set the marginal value product of labour, $p\frac{\partial Y_i}{\partial n_i}$, equal to the wage. The marginal product of labour, however,  is complicated by the presence of the  agglomeration effect, $A(\sum n_j)$:
\begin{eqnarray} \frac{\partial Y_i}{\partial n_i} &=   K_i^\alpha \left(  \beta A n_i^{\beta-1}  + n_i^{\beta}A'  \right)  \nonumber\\
&=   \beta\frac{1}{n_i} Y_i   +  Y_i \frac{A'}{A}  \nonumber  \\
&=   Y_i  \left[  \beta\frac{1}{n_i}  + \frac{A' }{A} \right] \label{eqn-mpl}
\end{eqnarray}
The first term in the square bracket in Equation~\ref{eqn-mpl} might be termed the \textbf{private myopic marginal product}. It is the addition to output directly attributable to an additional worker. This myopic MPL is smaller than the actual marginal product for the firm.  
The second term in the bracket   is the marginal agglomeration effect. It captures the effect on firm-wide labour productivity---an increase in effective labour---that results from adding a worker. We can expect this to be very small.\footnote{Using the specification in Footnote~\ref{footnote-psi}, $Lambda(n)=n^\psi$, it would be $\frac{\psi}{n}$. If f $\psi=0.1$ and $n=250,000$ the number is $\frac{A' }{A} =4\times 10^{-7}$.}% REVIEW THIS 
% REVIEW THIS TOO
%\footnote{Firm size matters. 
%A monopoly employer would take into account the marginal agglomeration effect. 
%A firm that employed a large enough fraction of the urban workforce to notice agglomeration effects, say $\frac{1}{n}<k<1$, would enjoy that fraction of the external effect and set the wage at  
%\[w_k =  \beta\left( \frac{1}{n}+ \frac{kA'}{A(n)} \right)	Y\].} 


It seems likely that the agglomeration effect of adding a worker on the productivity of other workers in that firm, $Y_i \frac{A'}{A}$, would be difficult to attribute to a new worker. It would be a lagged, unevenly distributed effect, and would appear exogenous, and so would not be compensated. We assume therefore that firms do not take the second term into account. %If we also assume that firms take the wage as parametric, firms hire until the private myopic marginal product falls to the observed wage, 
%		\[  \beta\frac{1}{n_i} Y_i =    w+\phi , \]
implying firms will hire fewer than the optimal number of workers.
\begin{table}[htbp]
\caption[Four views of the of the marginal agglomeration effect]{Four views of the of the marginal agglomeration effect, $\frac{A'}{A}$}

\begin{center}% CHECK with original. I may have screwede this version up
\begin{tabular}{rlcccc}\small
    & 	\hspace{2cm}$\frac{A'}{A}=$	& $.01$ & $.01$ & $.001$  &  $4\times 10^{-7}$\\ \cline{3-4}
\   &  	version  		& 1 firm 		&10 firms		&100 firms 	& 1000 firms		\\ \hline%\cline{3-5}
 1 &myopic 		&0 			 & 0			& 0       		&	0				\\
 2 &firm wide, 0CV 	& $0.01Y$ & 0           & 0	& 0\\
 3 &firm wide, 1CV	& $0.01Y$		& $0.1Y_i	$	& $0.1Y_i$	&$4\times 10^{-4}Y_i$	\\
4  &social 			& $0.01Y$ 	&  $0.1Y$		& $10Y_i$		&$4\times 10^{-4}Y_i$	\\
 \hline
\end{tabular}
\end{center}
\label{table-marginal-agglomeration}
\end{table}%


Even taking into account firm-wide labour productivity gains, the private marginal product of labour is likely to be computed on the assumption that other firms do not expand  their workforce. This could be call the `zero conjectural variation' (0CV) case. 
If all firms  were expected to respond to the same signal the same way (1CV), the agglomeration effect  would be multiplied by the number of firms, $\frac{n }{n_i}$. The marginal agglomeration effect for firm $i$ is then $\frac{n }{n_i}\frac{A' }{A}Y_i =\frac{A' }{A}Y$. 

Since the increase in $A$ affects all firms, the  social marginal product of all firms expanding their workforce by one worker as $i$ does must be multiplied again by the number of firms. The  value of the agglomeration effect increases with the number of firms. 

\begin{figure}[tb]
\begin{center}
\input{fig/growth-amenity.tex}
\caption{Multiple marginal products}
\label{fig-growth-amenity.tex}
\end{center}
\end{figure}

 Figure~\ref{fig-growth-amenity.tex} illustrates the labour supply curve and the four versions of MPL that arise for any standard production function with diminishing marginal product of labour and agglomeration effects of the sort we model. These agglomeration effects account for O'Sullivans axioms (b), (c) and (d) for this and similar models. 

 
\subsubsection{Output and wage}
We need a combination of classical and neoclassical distribution theory.

City output is divided among the classes of society. Neoclassical theory suggests wages are allocated according to marginal product and classical theory suggests rents according to the pattern of ownership.

Equation one, in effect determines a wage, (Given the observed values for the scaling coefficients for total wages and labour, $bW < 1.15$ and $bL < 1$, )  although there are many possible distributional specifications and many possible labour market and firm structures. Bettencourt provides two  estimates,  1.11 and 1.35, for the scale factor for urban personal income in the Brazil and South Africa respectively. A more recent  study supports the Bettancourt results for China.\footnote{Wu W, Zhao H, Tan Q, Gao P. An Urban Scaling Estimation Method in a Heterogeneity Variance Perspective. Entropy (Basel). 2019 Mar 28;21(4):337. doi: 10.3390/e21040337. PMID: 33267051; PMCID: PMC7514821.} 

\subsubsection{Wage and city size}
The third determines the extent of the city. This comes form the Alonso model discussed in chapter XXXXA. 

% PROBABLY REMOVE - FIGURE REPEATS
\begin{figure}
    \begin{center}
    \input{fig/rent-ricardo.tex}
    \caption{Transport costs, the yellow area, take a share of the profit for vegetables sold in the town}
    % \label{fig-rent-ricardo}
    \end{center}
\end{figure}

\begin{figure}
    \begin{center}
    \input{fig/rent-alonso.tex}
    \caption{A circular city with uniform transportation costs.}
    \label{fig-rent-alonso}
    \end{center}
\end{figure}

A simple case is the circular city with uniform transportation cost, $t$. \[r^*= \frac{w}{t}\]% A more complex model might have density depend on location, for example, in the continous circular cityt\,
If transportation costs vary by  distance we might have something like this constraint on extent\[w=\int_0^{d*} t(d)dt.\]

This approach imposes an equilibrium condition on the model. It is unnecessary working with a citation of known extent and density. The analytic approach is easily extended to variable transportation cost, although at the expense of additional computational complexity.

\subsubsection{City extent and population}
Equation  four  closes the model by linking the extent of the city to the population. A simple case is the circular city with uniform population $d$, where $d$ is density per unit area and $r^*$ is the radius of the city: \[P=d\pi r^{*2}\] 
More generally, density might vary with for example, the distance $r$ from the centre of the city:
\[P=\pi \int_{0}^{r*}d(r)\,dr\] 
In a computational model a table of densities would provide the link.



\subsubsection{challenges}
maybe discuss some of the modeling challenges - division of income, lags, ???

\vspace{2cm}


\subsection{Cities becoming productive}
 The growth of many cities was initially fueled by agricultural rents and resource exports. The industrial revolutions transformed many of these consumption cities into thriving production centers. 

while the ``origins'' of consumption cities can be traced to (i)
resource rents, (ii) rents from agricultural exports in countries with sufficiently high agricultural productivity, and (iii) ``premature'' deindustrialization.  Source:
%\href{https://www.brookings.edu/blog/future-development/2022/07/14/1622441/}
{Are cities engines of production or consumption, and does it matter?}


\section{Model assumptions}
\begin{enumerate}
\item There is full employment, no frictional unemployment, and no labour adjustment costs.
\item Firms set output and factor inputs to maximize profits, so factors are paid the value of their marginal private product
\item Demand for output is perfectly elastic (constant price = 1)
\end{enumerate}


Rural producers pay a wage $\psi$. this covers a standard house, lot, entertainment, diet and consumption pattern. We  choose units so that per-period cost of a unit of productive capital is also $\psi$





\chapter{Model}



\section{OLD Implementation}


Household agents have:
\begin{enumerate}
   \item A home. Agents live somewhere, inside or outside the city,
   \item finances: they have assets, a housing budget, income, and a spending pattern - family lending pattern  
   shaped by profession, demographics, family structure, etc.) - risk profile
   \item utility function: they have a utility function with location  preferences - amenity, open space, house size requirements, transportation costs - shaped by profession, demographics, family structure, etc
\end{enumerate}	

Buyers then consult with a financial agent to determine the maximum mortgage and interest rate they'd qualify for based on their income. This gives an upper bound to the range of homes they may consider. 

Finally agents valuate the homes offered and place bids. % For simplicity of implementation, they place bids on all homes they consider. 

%Calculate willingness to pay
%Consider options
%Place bids
%
%Calculate willingness to pay (urgency/position on the market)
%Assess need for housing
%- Urgency of need Unhoused, sold house or served notice? 
%- Family or demographic changes
%- Financial viability of current situation
%Assess financial situation
%Get Max mortgage and max carrying cost given income and wealth from a bank
%Get options from real estate agent
%Place bids based on xy
%Consider options
%Place bids
%
%BUYER
%Enter market to buy
%Decide level of urgency (or decide with prospect theory - functional form for optimism/urgency/time to choose)
%(income/wealth)
%Maximum mortgage 
%Maximum carrying cost
%Household attributes - household size, employment location, amenity
%Current housing
%
%Realtor gives list of houses to look (real estate search -e.g. price range)
%Place offers - low if can't afford, higher if market is tight
%If failed, consider renting or buying next time.

\begin{figure}[htb]
    \begin{center}
 \tikzstyle{decision} = [diamond, draw, fill=blue!20, 
     text width=4.5em, text badly centered, node distance=3cm, inner sep=0pt]
 \tikzstyle{block} = [rectangle, draw, fill=blue!20, 
     text width=5em, text centered, rounded corners, minimum height=4em]
 \tikzstyle{line} = [draw, -latex']
 \tikzstyle{cloud} = [draw, ellipse,fill=red!20, node distance=3cm,
     minimum height=2em]
%
 \begin{center}
 \begin{tikzpicture}[node distance = 2cm, auto]
     % Place nodes
     \node [block] (need) {Assess need for housing};
     \node [block, below of=need] (finance) {Assess financial situation};
     \node [block, below of=finance] (alternatives) {Select homes to consider};    
     \node [block, below of=alternatives] (bid) {Place bids on homes};    
     % Draw edges
     \path [line] (need) -- (finance);
     \path [line] (finance) -- (alternatives);
     \path [line] (alternatives) -- (bid);        
 \end{tikzpicture}   
 \end{center}
    \caption{Worker housing flow chart.}
    \label{fig-code-worker-choice}
    \end{center}
\end{figure}

\subsection{Initial conditions}
Initialize the model with grid. Each element contains 1 housing unit.

The model space is divided into a uniform grid of single family homes % Additions: apartment buildings, a mechanism to subdivide homes, rent bedrooms, accumulate adjacent land and build new higher density buildings, an urban land boundary, a mechanism for wealth agglomeration through density.

The social structure of the model begins with urban workers who commute and earn wages in the urban commuter-shed, and rural residents and landowners who may choose to move to the city. 
We imagine the initial set of workers in our city commuting daily, being paid monthly and residing in urban housing for their working lives, which are arbitrarily set. 

Initially all urban workers are also homeowners. When we allow the initial urban residents to retire, they may sell or rent out their properties to new workers. This introduces an additional \gls{class} of resident, the urban tenant. The final agent in the model is a `bank' that represents both the financial sector and the owners of financial capital. The bank provides mortgage funds can %may actively 
purchase land as a financial asset on behalf of investors.

\subsection{Model Steps - Housing market}
% Figure xyz traces the flow. 
In each time step agents firms update wages and job availability, agents decide whether to work and whether to buy and sell homes.
 % Schedule: Multi step by breed
 % Steps Labour
 % step - workers: market/production, enter market to buy, list properties real estate agent matches agents - has bids 
 % bidding - workers and firm consider properties and make bids (2nd step or spread over 2 steps)
 % negotiation - sellers consider and accept bids (or real estate agents manage negotiation)
%Buyers evaluate their need for housing.
% Agents decide whether to enter the housing market as a renter or a buyer.

at every time step 
    1) Some new tenants arrive into the city
    
    2) All unhoused tenants look for a housing unit 
    
        a) They have to decide whether to buy or rent. Decision depends on their income, and the availability of Corporation of Public Housing loans 


        b) If they buy, they seek apartment and evaluate, and place a bid (see ALMA)
        
        c) if they rent, they look for an apartment that matches xyz criteria, and place request to rent. Rental is given by the landlord to the first tenant that matches the asking rental price. 


Workers give up their search and leave the city if they do not find a housing unit 

%\input{notes_and_references/z Background rough notes - rent history etc.tex}


\subsection{***Initialization}

% We explore the wealth forming dynamics of the urban agglomeration effect by modelling % a city in which 
Agents work in the city and leave their jobs when they reach retirement age.
New agents enter the city to work.

% There is an outside world in two respects. NEAT 
 
 If there is a housing market, agents can move. %In the analytic case above, the population stays in place, and travels to work if it is worthwhile given the transportation costs. 
%Those who come to the city will be those for whom the benefits the city offers make it worthwhile to  whether that's building their network, accessing markets, accessing amenity, learning, finding specialized employment, or increased wages. In this model 
The demand for labour drives urban growth. % The housing market depends on how many people from the periphery are completing to claim places in the city. TODO IF ANY RURAL AGENT COULD MOVE IF THE CITY HAS ADDITIONAL DEMAND FOR LABOUR, HOW DO WE DECIDE WHICH DO? Could use a parameter for immigration (or how 'hot' the market is) and in the simplest case (corresponding to how many agents from outside are looking at the housing/rental market), have the inflow match. % Agents have debt and there is an undifferentiated labour market


Workers can leave the workforce and retire, and new people can come into the city. 

Initially, all homes are owner-occupied. This is of interest as a starting point because we are interested in the evolution of a society with widespread home ownership in the face of financialization pressures. 

We also start with owners who have a long run before retirement. The housing market is  during the initialisation runs to allow the wage and population to converge. The all-ownership, no-turnover case provides a basis for expectation-formation and examining the basic population-productivity dynamic. 

When agents reach the end of their set working lives they retire. %It is easy to introduce random life events, differentiated households and other variety, but while this kind of variation is likely to generate  complex and interesting life stories it is not what we choose to focus on at this stage.  
Owners may sell their homes and either leave the city or move to cheaper housing. the latter would put pressure on housing supply. New entrants to the labour force come from outside of the city at various stages in their life cycle and either buy or rent homes. 

\section{ANALYSIS - MOVE}
\epigraph{``An economist is someone who says, when an idea works in practice, `let's see if it works in theory.'''
Walter W. Heller, former chairman of the Council of Economic Advisers.}{ Walter W. Heller, former chairman of the Council of Economic Advisers. (\href{https://quoteinvestigator.com/2015/08/30/practice/}{1979, The Washington Star)}}


The model shows how land rent is captured by landowners and how that affects wealth creation and the development of the city. 
Rents go to landowners. %the owners of a given property. 
Landowners therefore capture a fraction of the wage premium generated by agglomeration.
If workers own their own homes, rents go to them. If others own the land, they capture them.

Land value rises as the city grows, so newcomers pay more for housing near the centre.

% Agglomeration benefits get extracted by landowners. Labour gets only their marginal value they don't get any of the surplus. They don't even keep always their marginal value.
The dynamic story is that the class of landowners eventually becomes financial capital.
PLOT RENTS HERE
The value of land increases over time. Those who purchase land earlier claim a share of the growing value of the city. % As the city grows, they own an increasingly valuable asset.
 
%In this model, workers are the initial owners, but they build this wealth which becomes a source of capital that can support them.
EQUATION FOR THE SHARE THEY CAN CAPTURE

In the case in which individual workers purchase houses and then sell them on retirement, the housing market drives the creation of classes on its own. A strictly random process in which agents have a range of ages and sell at retirement creates a structural advantage where workers who arrive earlier in the city and own land, benefit from their own labour but also get to claim a share of the productive output of the city as it grows. % those who begin work later. % to a division in wealth
%the emergence of a class of those who came early and those who came late.
%Early agents may also rent out their land. Could it be though of as a pyramid scheme?

%With financialization, in the case where 
If financialized buyers can access a better interest rate, they can consolidate ownership, capture rents, drive class differentials, and amplify wealth inequality. % This appears to be the case as lenders offer wealthier and larger entities lower interest rates. % We expect to observe in this class of models larger, likely power law-distributed, wealth effects.

%There is a supply of money- if there's too much for other investments, some will flow here- e.g. excess liquidity.

\subsection{Implications}
- totaly tax maintained
Germany higher natural redistribution..

This fits empirical results of increasing financialzaiton 70+ financialized
Fr\'ed\'erick Demers found that the response of housing investment to interest rates has become more pronounced over time \cite{demersModellingForecastingHousing2005}. %Modelling and Forecasting Housing Investment: The Case of Canada,  Research Department, Bank of Canada, Ottawa, Ontario, Canada K1A 0G9 fdemers@bankofcanada.ca



Friedman's 1953 essay, ``The Case for Flexible Exchange Rates'' \cite{friedmanEssaysPositiveEconomics1953} argued that speculation is stabilizing. Market prices in this view  are set on the basis of economic fundamentals- what we call the warranted price. When prices diverge from those fundamentals that creates a profitable opportunity. Speculators then step in and buy or sell, driving prices back to the level warranted by fundamentals.

Increasing the number of traders and volume of trading is also regarded as improving financial market outcomes. Increased trade volume increases market liquidity 



\section{Intro conclusions/summary}
The model has a Solow-Swan style production model with agglomeration effects using a \gls{Cobb-Douglas} production function that incorporates Jacobs-style labour-augmenting agglomeration economies %(Beaudry and Schiauerova 2009, Panne 2004, J. Jacobs 1969), 
in the way neoclassical growth theory incorporates labour-augmenting technical change.
It integrates the production function with an Alonso-style urban model of a city economy \cite{alonsoTheoryUrbanLand1960}.


