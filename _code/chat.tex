DR Dec 5
https://www.generationatomic.org/
https://www.facebook.com/generationatomic/

k4robins@uwaterloo.ca
https://studiolab.sagemaker.aws/users/kirsten

Here is the complete list. ones want to see are pulled to the left margin
Example - Bar cross bottom?  This would be easy to crop out. Latex needs us to label figures in the document not in the figure.

Experiment title. 'adjF': 0.02, 'adjw': 0.05,'discount_rate': 0.07,'r_margin': 0.01, CGT_person':   0.0, # share 0-1,  CGT_investor': 1, # share 0-1

'adjF'
'adjw'
'discount_rate'
'r_margin'
'max_mortgage_share'
'capital_gains_tax_person'
'capital_gains_tax_investor'


        # LABOUR MARKET AND FIRM PARAMETERS
            'subsistence_wage': 40000., # psi
            'init_city_extent': 10.,    # CUT OR CHANGE?
            'seed_population': 400,
            'init_wage_premium_ratio': 0.2, # 1.2, ###

            # PARAMETERS MOST LIKELY TO AFFECT SCALE
            'c': 300                             ### .0,                            ###
            'price_of_output': 10,                 ######
            'density':600,                         #####
            'A': 3000,
            'alpha': 0.18,
            'beta':  0.75,
            'gamma': 0.12, ### reduced from .14
            'overhead': 1.5,
            'mult': 1.2,
            'adjN': 0.15,
            'adjk': 0.10,
            'adjn': 0.15,
'adjF': 0.02,
'adjw': 0.05, 
            'dist': 1, 
            'init_F': 100.0,
            'init_k': 500.0,
            'init_n': 100.0,

            # HOUSING AND MORTGAGE MARKET PARAMETERS
            'mortgage_period': 5.0,       # T, in years
            'working_periods': 40,        # in years
            'savings_rate': 0.3,
'discount_rate': 0.07,        # 1/delta    Check THIS
            'r_prime': 0.05,
'r_margin': 0.01,
            'property_tax_rate': 0.04,     # tau, annual rate, was c
            'housing_services_share': 0.3, # a
            'maintenance_share': 0.2,      # b
'max_mortgage_share': 0.9,
            'ability_to_carry_mortgage': 0.28,
            'wealth_sensitivity': 0.1,
'capital_gains_tax_person':   0.0, # share 0-1
'capital_gains_tax_investor': 1, # share 0-1
 

\section{needed experiments Dec 14 DR}
\begin{enumerate}
    \item capital gains tax matters - find if there is a phase boundary - i.i. where in 

            'capital_gains_tax_person': [0.5, 0.01], # share 0-1

            'capital_gains_tax_investor': [0.5, 0.1], # share 0-1

            does investor share begin to rise (defined as ``for a given number of steps - say 70 - where is $Z=share_t - share_{t-1} \ge 0$? ) and where does it fall.

Maybe just store Z and and draw contour lines - there has to be as program for that.
\end{enumerate}
\section{parameter values form DR}
batch_parameters = {
            'data_collection_period': 1,
            'iterations': 1,
            'max_steps': 200
}

# List variable_parameters for experiments
    experiment_parameters_list = [
         {
            #'density': [800, 600],# 400, 200],
            'subsistence_wage':[40000],#[90000],[ 50000, 40000, 30000]
            #'gamma': [0.1, 0.09, 0.08 ]
            #'discount_rate': [.1, .8, .7, .6, .5]
            #'max_mortgage_share': [1.0, 0.9, 0.8, 0.7, 0.6]
            #'wealth_sensitivity': [0.1, .03, .05]
            #'ability_to_carry_mortgage': [0.35, 0.28, 0.2]
            #'savings_rate': [0.5, 0.3, 0.1]
        },
        # {
        #     'density': [1, 100],
        #     'subsistence_wage': [10000, 30000]
        # },
        # {
        #     'density': [1, 100],
        #     'gamma': [0.001, 0.02, 0.7]
        # }
    ]
    
    # Define fixed parameters, replaced by variable_parameters if there is a conflict
    fixed_parameters = {
                'run_notes': 'Debugging model.',
                'subfolder': None,
                'width':     50, #30,
                'height':    50, #30,
    
                # FLAGS
                'demographics_on': True,  # Set flag to False for debugging to check firm behaviour without demographics or housing market
                'center_city':     False, # Flag for city center in center if True, or bottom corner if False
                # 'random_init_age': False,  # Flag for randomizing initial age. If False, all workers begin at age 0
                'random_init_age': True,  # Flag for randomizing initial age. If False, all workers begin at age 0
    
                # LABOUR MARKET AND FIRM PARAMETERS
                'subsistence_wage': 40000., # psi
                'init_city_extent': 10.,    # CUT OR CHANGE?
                'seed_population': 400,
                'init_wage_premium_ratio': 0.2, # 1.2, ###
    
                # PARAMETERS MOST LIKELY TO AFFECT SCALE
                'c': 300.0,                            ###
                'price_of_output': 10,                 ######
                'density':600,                         #####
                'A': 3000,                             ### 
                'alpha': 0.18,
                'beta':  0.75,
                'gamma': 0.12, ### reduced from .14
                'overhead': 1.5,
                'mult': 1.2,
                'adjN': 0.15,
                'adjk': 0.10,
                'adjn': 0.15,
                'adjF': 0.02,
                'adjw': 0.02, 
                'dist': 1, 
                'init_F': 100.0,
                'init_k': 500.0,
                'init_n': 100.0,
    
                # HOUSING AND MORTGAGE MARKET PARAMETERS
                'mortgage_period': 5.0,       # T, in years
                'working_periods': 40,        # in years
                'savings_rate': 0.3,
                'discount_rate': 0.07,        # 1/delta
                'r_prime': 0.05,
                'r_margin': 0.01,
                'property_tax_rate': 0.04,     # tau, annual rate, was c
                'housing_services_share': 0.3, # a
                'maintenance_share': 0.2,      # b
                'max_mortgage_share': 0.9,
                'ability_to_carry_mortgage': 0.28,
                'wealth_sensitivity': 0.1,
            }


ownership

MPL     n
N       F
extent  k   % I just removed N/f because by def'n N=Fn, I think 
ownership       

Experiments. thinking about this. I am interested in tests to fine-tune the model but let's instead go on to work with the determinants of ownership. 



navigate to the housing_app folder in Terminal. cd Devel/housing_app
source activate housing
python batch_run.py


July 8 DRR

The price a property might sell at would be $\omega - {dc} + \mathbb{A} + rural-op-cost + conversion cost$. For simplicity, we drop the last two terms. Conversion cost would be amortized over a very long period and would be small in any case. We have hidden the rural-op-cost in $a\psi$.


Equation~\ref{eqn-property-investment-return2} implies a `bang-bang' control---with all sales going to the richest participant unless there are limits on the size of capital flows. For our simulation, we implement such limits.  Removed from Ch modle 


---

THIS IS THE CODE THAT I HAVE WORKING
The figure simply shows that both variables behave as expected.
because there is no lag and no partial adjustments it all happens in the first 5 cycles.


Changes are indicated with a training ######

import matplotlib.pyplot as plt

# Initialize variables
A     = 10
gamma =1.2
transport_cost_per_dist = 1
population = 1000
transport_cost_per_dist = 4
density = 10
seed_population = 0
#P=10000
t = []
wage_premium_list = []
population_list   = []
P_list            = []   ######

for time_step in range (10):
    # Calculate wage premium and population #REVERSE ORDER
    wage_premium = gamma*A * population**(gamma-1) #actually this was wage
    population =  2*(wage_premium / transport_cost_per_dist)**2 * density + seed_population
    P = population/100  ######
    
    # wage_premium = gamma*A * population**(gamma-1)#actually this is wage
    # population = 2*(wage_premium / transport_cost_per_dist)**2 * density + seed_population

    # Record output
    t.append(time_step)
    wage_premium_list.append(wage_premium)
    population_list.append(population)
    P_list.append(P)    ############

# Plot wage premium and population against time
import matplotlib.pyplot as plt

# IS THIS THE SINGLE FIGURE   Sept 9 YES
plt.figure(figsize=(10, 6))
plt.plot(t, wage_premium_list, label='Wage Premium')
#plt.plot(t, population_list, label='Population')######
plt.plot(t, P_list, label='Population/100')      ######
plt.ylabel('Value')
plt.xlabel('Time')
plt.title('Population and Wage Premium Over Time')
plt.legend()
plt.show()



 

 ax.set_ylabel(model_out_key, fontsize=20)

 figure 6.1 model logic says we are up in the uppeer block. This is what we need to unpack more. There is a cycle that has to work:

(productivity + wage) -> adjust(wage, n) -> population -> productivity 
 
How can people go up when workers goes down?

why does it start removing agents at step 35


Pushed another change

#add horizontal and vertical reference lines
plt.axhline(y = 0, xmin = 0., color ='black')# zero 
plt.axvline(x = 10, ymin = 0., color ='red')
plt.text(10.5, 400000, r'intitial city boundary', fontsize=15)
plt.text(1, 7000, r'zero rent', fontsize=15)

type
git stash
then 
git pull origin master





"distance_from_center": lambda a: getattr(a, "distance_from_center", None) if isinstance(a, Land) else None,


---

        }
        agent_reporters      = {
            "time_step":         lambda a: a.model.time_step,
            "agent_class":       lambda a: type(a),
            "agent_type":        lambda a: type(a).__name__,
            "id":                lambda a: a.unique_id,
            "x":                 lambda a: a.pos[0],
            "y":                 lambda a: a.pos[1],
            "distance_from_center": lambda a: getattr(a, "distance_from_center", None) if isinstance(a, Land) else None,
            "wage":                 lambda a: getattr(a, "wage", None) if isinstance(a, Land) else None,
            "is_working":           lambda a: None if not isinstance(a, Person) else 1 if a.unique_id in a.workforce.workers else 0,
            # "is_working":        lambda a: getattr(a, "is_working", None),
            "working_period":    lambda a: getattr(a, "working_period", None),
            "property_tax_rate": lambda a: getattr(a, "property_tax_rate", None),
            "net_rent":          lambda a: getattr(a, "net_rent", None) if isinstance(a, Land) else None,
            "warranted_price":   lambda a: getattr(a, "warranted_price", None) if isinstance(a, Land) else None,
        }




KeyError                                  Traceback (most recent call last)
File ~/anaconda/envs/housing/lib/python3.9/site-packages/pandas/core/indexes/base.py:3629, in Index.get_loc(self, key, method, tolerance)
   3628 try:
-> 3629     return self._engine.get_loc(casted_key)
   3630 except KeyError as err:

File ~/anaconda/envs/housing/lib/python3.9/site-packages/pandas/_libs/index.pyx:136, in pandas._libs.index.IndexEngine.get_loc()

File ~/anaconda/envs/housing/lib/python3.9/site-packages/pandas/_libs/index.pyx:163, in pandas._libs.index.IndexEngine.get_loc()

File pandas/_libs/hashtable_class_helper.pxi:5198, in pandas._libs.hashtable.PyObjectHashTable.get_item()

File pandas/_libs/hashtable_class_helper.pxi:5206, in pandas._libs.hashtable.PyObjectHashTable.get_item()

KeyError: 'distance_from_center'

The above exception was the direct cause of the following exception:

KeyError                                  Traceback (most recent call last)
Cell In[120], line 49
     46 axs[0, i].grid(False)
     48 # Create scatter plot for distance from center vs warranted price
---> 49 scatter = axs[1, i].scatter(land_agents['distance_from_center'], land_agents['warranted_price'], c='blue', alpha=0.5)
     50 axs[1, i].set_title(f'Distance vs Warranted Price at Time Step {time_step}')
     51 axs[1, i].set_xlabel('Distance from Center')

File ~/anaconda/envs/housing/lib/python3.9/site-packages/pandas/core/frame.py:3505, in DataFrame.__getitem__(self, key)
   3503 if self.columns.nlevels > 1:
   3504     return self._getitem_multilevel(key)
-> 3505 indexer = self.columns.get_loc(key)
   3506 if is_integer(indexer):
   3507     indexer = [indexer]

File ~/anaconda/envs/housing/lib/python3.9/site-packages/pandas/core/indexes/base.py:3631, in Index.get_loc(self, key, method, tolerance)
   3629     return self._engine.get_loc(casted_key)
   3630 except KeyError as err:
-> 3631     raise KeyError(key) from err
   3632 except TypeError:
   3633     # If we have a listlike key, _check_indexing_error will raise
   3634     #  InvalidIndexError. Otherwise we fall through and re-raise
   3635     #  the TypeError.
   3636     self._check_indexing_error(key)

KeyError: 'distance_from_center'